(function(root){var exports=undefined,module=undefined,require=undefined;var define=undefined;var self=root,window=root,global=root,globalThis=root;(function(){!function(e){"use strict";function t(e,t,i,s){var r,n=arguments.length,a=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(n<3?r(a):n>3?r(t,i,a):r(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a;}function i(e,t,i,s){return new(i||(i=Promise))(function(r,n){function a(e){try{d(s.next(e));}catch(e){n(e);}}function o(e){try{d(s.throw(e));}catch(e){n(e);}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t);})).then(a,o);}d((s=s.apply(e,t||[])).next());});}"function"==typeof SuppressedError&&SuppressedError;const s={game_name:"我爱盖房子",tb_appId:"34510261",tb_cloudAppId:"49650",tb_game_id:"3000000116142271",game_id:"10143",channel_id:"10143",version:"1.2.6",appkey:"d7f13f20c16bd58b5a90c6d109d0860b",interstitialAdId:"",bannerId:"ad_tiny_2021003184609526_202303302200048738",customId:"adunit-3ecef510636baa07",videoAd:"mm_5427047110_3047400474_115727700066",shareMessageToFriend:{scene:0,sharekey:"shareMessageToFriendScene",share_id:26},default_share:{content:"还记得童年的泡泡龙吗？一起来怀旧吧~    这个可以不？",icon:"https://cdn-wxsdk.miso-lab.com/f0/5653094b6b7826c8afd813d12735e3.jpg",id:"9999",key:"default",title:"默认",typ:1,videoid:""},MidasPay:{OfferId:"xxxx",ZoneId:"1",Mode:"game",CurrencyType:"CNY",Platform:""}},r={Version:"https://wxsdk-ver.d3games.com/version",Login:{Prod:"https://login-wxsdk.d3games.com/",Pre:"https://login-wxsdk-pre.d3games.com/"},Dot:{Prod:"https://wxsdk-api.cn-beijing.log.aliyuncs.com/",Pre:"https://wxsdk-api.cn-beijing.log.aliyuncs.com/"},Game:{Prod:"https://wxsdk-data.d3games.com/",Pre:"https://wxsdk-data-pre.d3games.com/"},Order:{Prod:"https://wxsdk-order.d3games.com/",Pre:"https://wxsdk-order-pre.d3games.com/"},GM:{Prod:"https://hermes.d3games.com/",Pre:"http://wxadmin.pre.d3games.com/"}},n={Active:"logstores/login/track",AdStat:"logstores/adlog/track",logOut:"logstores/times/track",Share:"logstores/share/track",loadingFinish:"logstores/firstsecren/track",loading:"logstores/loading/track",stay:"logstores/stay/track",behaviors:"logstores/behaviors/track",dot:"logstores/events/track",jumps:"logstores/jumps/track",level:"logstores/level/track",role:"logstores/role/track",client_log:"logstores/client_log/track",consume:"logstores/consume/track",daystay:"logstores/daystay/track",headSet:"headurl/set",rankAdd:"game/totalrank/add",rankList:"game/totalrank/list",sendsubscribe:"api/subscribe/event",cancelSubscribe:"api/subscribe/event/cancel",wxDecryption:"api/{{gameid}}/wx/decryption",notice:"game/notice/info",behavior:"api/douyin/behavior",dy2wxReport:"api/{{gameid}}/ad/addiction/report",wxEstimate:"api/{{gameid}}/wx/estimate",attribute:"api/member/attribute/set",checkmsg:"api/wx/checkmsg",updateNickname:"api/member/update/nickname",wxencrypted:"api/wx/encrypted",tbAwardAd:"api/{{gameid}}/task/award/list",receiveTbAward:"api/{{gameid}}/task/award/receive",douyinFeedAdd:"api/{{gameid}}/douyin/feed/add",douyinFeedCard:"api/{{gameid}}/douyin/feed/card/member/add",preorder:"api/order/v2/preorder",aliMission:"api/ali/incrementgameaction/submit",alipayIntergralBuy:"api/ali/point/pay",alipayIntergralAuth:"api/ali/point/auth",alipayIntergralQuery:"api/ali/point/query",isAddHomePage:"api/ali/homepage/consult",Version:"api/{{gameid}}/version",Login:"api/{{gameid}}/login",weakLogin:"api/{{gameid}}/login",Reftoken:"api/{{gameid}}/reftoken",ShareList:"api/{{gameid}}/share/list",getConfig:"api/{{gameid}}/game/config",saveData:"api/{{gameid}}/member/savedata",getData:"api/{{gameid}}/member/getdata",adList:"api/{{gameid}}/adplan/list",rankListV2:"api/{{gameid}}/rank/list",rankAddV2:"api/{{gameid}}/rank/add",serverTime:"api/{{gameid}}/game/server",mail:"api/{{gameid}}/mail/list",mailStatus:"api/{{gameid}}/mail/status",goodsList:"api/{{gameid}}/order/goodslist",orderReport:"api/order/v2/mimas/new",createOrder:"api/{{gameid}}/order/create",queryOrder:"api/{{gameid}}/order/query",confirmOrder:"api/{{gameid}}/order/receive"};class a{constructor(){this._canUsed=!1;}init(e=750,t=750){}destory(){console.log("不支持平台,销毁banner");}hide(){console.log("不支持平台,隐藏banner");}show(e=!0){return console.log("不支持平台,显示banner"),!0;}create(e=s.bannerId,t=!0,i){console.log("不支持平台,创建banner");}}class o{constructor(){this._canUsed=!1;}create(e,t){console.log("不支持平台,创建原生模板广告");}hide(){console.log("不支持平台,隐藏原生模板广告");}destory(){console.log("不支持平台,销毁原生模板广告");}show(e=!0){return console.log("不支持平台,显示原生模板广告"),!0;}}class d{static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t);}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t);}static _hex(e){const t=d.hexChars,i=d.hexOut;let s,r,n,a;for(a=0;a<4;a+=1)for(r=8*a,s=e[a],n=0;n<8;n+=2)i[r+1+n]=t.charAt(15&s),s>>>=4,i[r+0+n]=t.charAt(15&s),s>>>=4;return i.join("");}static _md5cycle(e,t){let i=e[0],s=e[1],r=e[2],n=e[3];i+=(s&r|~s&n)+t[0]-680876936|0,i=(i<<7|i>>>25)+s|0,n+=(i&s|~i&r)+t[1]-389564586|0,n=(n<<12|n>>>20)+i|0,r+=(n&i|~n&s)+t[2]+606105819|0,r=(r<<17|r>>>15)+n|0,s+=(r&n|~r&i)+t[3]-1044525330|0,s=(s<<22|s>>>10)+r|0,i+=(s&r|~s&n)+t[4]-176418897|0,i=(i<<7|i>>>25)+s|0,n+=(i&s|~i&r)+t[5]+1200080426|0,n=(n<<12|n>>>20)+i|0,r+=(n&i|~n&s)+t[6]-1473231341|0,r=(r<<17|r>>>15)+n|0,s+=(r&n|~r&i)+t[7]-45705983|0,s=(s<<22|s>>>10)+r|0,i+=(s&r|~s&n)+t[8]+1770035416|0,i=(i<<7|i>>>25)+s|0,n+=(i&s|~i&r)+t[9]-1958414417|0,n=(n<<12|n>>>20)+i|0,r+=(n&i|~n&s)+t[10]-42063|0,r=(r<<17|r>>>15)+n|0,s+=(r&n|~r&i)+t[11]-1990404162|0,s=(s<<22|s>>>10)+r|0,i+=(s&r|~s&n)+t[12]+1804603682|0,i=(i<<7|i>>>25)+s|0,n+=(i&s|~i&r)+t[13]-40341101|0,n=(n<<12|n>>>20)+i|0,r+=(n&i|~n&s)+t[14]-1502002290|0,r=(r<<17|r>>>15)+n|0,s+=(r&n|~r&i)+t[15]+1236535329|0,s=(s<<22|s>>>10)+r|0,i+=(s&n|r&~n)+t[1]-165796510|0,i=(i<<5|i>>>27)+s|0,n+=(i&r|s&~r)+t[6]-1069501632|0,n=(n<<9|n>>>23)+i|0,r+=(n&s|i&~s)+t[11]+643717713|0,r=(r<<14|r>>>18)+n|0,s+=(r&i|n&~i)+t[0]-373897302|0,s=(s<<20|s>>>12)+r|0,i+=(s&n|r&~n)+t[5]-701558691|0,i=(i<<5|i>>>27)+s|0,n+=(i&r|s&~r)+t[10]+38016083|0,n=(n<<9|n>>>23)+i|0,r+=(n&s|i&~s)+t[15]-660478335|0,r=(r<<14|r>>>18)+n|0,s+=(r&i|n&~i)+t[4]-405537848|0,s=(s<<20|s>>>12)+r|0,i+=(s&n|r&~n)+t[9]+568446438|0,i=(i<<5|i>>>27)+s|0,n+=(i&r|s&~r)+t[14]-1019803690|0,n=(n<<9|n>>>23)+i|0,r+=(n&s|i&~s)+t[3]-187363961|0,r=(r<<14|r>>>18)+n|0,s+=(r&i|n&~i)+t[8]+1163531501|0,s=(s<<20|s>>>12)+r|0,i+=(s&n|r&~n)+t[13]-1444681467|0,i=(i<<5|i>>>27)+s|0,n+=(i&r|s&~r)+t[2]-51403784|0,n=(n<<9|n>>>23)+i|0,r+=(n&s|i&~s)+t[7]+1735328473|0,r=(r<<14|r>>>18)+n|0,s+=(r&i|n&~i)+t[12]-1926607734|0,s=(s<<20|s>>>12)+r|0,i+=(s^r^n)+t[5]-378558|0,i=(i<<4|i>>>28)+s|0,n+=(i^s^r)+t[8]-2022574463|0,n=(n<<11|n>>>21)+i|0,r+=(n^i^s)+t[11]+1839030562|0,r=(r<<16|r>>>16)+n|0,s+=(r^n^i)+t[14]-35309556|0,s=(s<<23|s>>>9)+r|0,i+=(s^r^n)+t[1]-1530992060|0,i=(i<<4|i>>>28)+s|0,n+=(i^s^r)+t[4]+1272893353|0,n=(n<<11|n>>>21)+i|0,r+=(n^i^s)+t[7]-155497632|0,r=(r<<16|r>>>16)+n|0,s+=(r^n^i)+t[10]-1094730640|0,s=(s<<23|s>>>9)+r|0,i+=(s^r^n)+t[13]+681279174|0,i=(i<<4|i>>>28)+s|0,n+=(i^s^r)+t[0]-358537222|0,n=(n<<11|n>>>21)+i|0,r+=(n^i^s)+t[3]-722521979|0,r=(r<<16|r>>>16)+n|0,s+=(r^n^i)+t[6]+76029189|0,s=(s<<23|s>>>9)+r|0,i+=(s^r^n)+t[9]-640364487|0,i=(i<<4|i>>>28)+s|0,n+=(i^s^r)+t[12]-421815835|0,n=(n<<11|n>>>21)+i|0,r+=(n^i^s)+t[15]+530742520|0,r=(r<<16|r>>>16)+n|0,s+=(r^n^i)+t[2]-995338651|0,s=(s<<23|s>>>9)+r|0,i+=(r^(s|~n))+t[0]-198630844|0,i=(i<<6|i>>>26)+s|0,n+=(s^(i|~r))+t[7]+1126891415|0,n=(n<<10|n>>>22)+i|0,r+=(i^(n|~s))+t[14]-1416354905|0,r=(r<<15|r>>>17)+n|0,s+=(n^(r|~i))+t[5]-57434055|0,s=(s<<21|s>>>11)+r|0,i+=(r^(s|~n))+t[12]+1700485571|0,i=(i<<6|i>>>26)+s|0,n+=(s^(i|~r))+t[3]-1894986606|0,n=(n<<10|n>>>22)+i|0,r+=(i^(n|~s))+t[10]-1051523|0,r=(r<<15|r>>>17)+n|0,s+=(n^(r|~i))+t[1]-2054922799|0,s=(s<<21|s>>>11)+r|0,i+=(r^(s|~n))+t[8]+1873313359|0,i=(i<<6|i>>>26)+s|0,n+=(s^(i|~r))+t[15]-30611744|0,n=(n<<10|n>>>22)+i|0,r+=(i^(n|~s))+t[6]-1560198380|0,r=(r<<15|r>>>17)+n|0,s+=(n^(r|~i))+t[13]+1309151649|0,s=(s<<21|s>>>11)+r|0,i+=(r^(s|~n))+t[4]-145523070|0,i=(i<<6|i>>>26)+s|0,n+=(s^(i|~r))+t[11]-1120210379|0,n=(n<<10|n>>>22)+i|0,r+=(i^(n|~s))+t[2]+718787259|0,r=(r<<15|r>>>17)+n|0,s+=(n^(r|~i))+t[9]-343485551|0,s=(s<<21|s>>>11)+r|0,e[0]=i+e[0]|0,e[1]=s+e[1]|0,e[2]=r+e[2]|0,e[3]=n+e[3]|0;}constructor(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start();}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(d.stateIdentity),this;}appendStr(e){const t=this._buffer8,i=this._buffer32;let s,r,n=this._bufferLength;for(r=0;r<e.length;r+=1){if(s=e.charCodeAt(r),s<128)t[n++]=s;else if(s<2048)t[n++]=192+(s>>>6),t[n++]=63&s|128;else if(s<55296||s>56319)t[n++]=224+(s>>>12),t[n++]=s>>>6&63|128,t[n++]=63&s|128;else{if(s=1024*(s-55296)+(e.charCodeAt(++r)-56320)+65536,s>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[n++]=240+(s>>>18),t[n++]=s>>>12&63|128,t[n++]=s>>>6&63|128,t[n++]=63&s|128;}n>=64&&(this._dataLength+=64,d._md5cycle(this._state,i),n-=64,i[0]=i[16]);}return this._bufferLength=n,this;}appendAsciiStr(e){const t=this._buffer8,i=this._buffer32;let s,r=this._bufferLength,n=0;for(;;){for(s=Math.min(e.length-n,64-r);s--;)t[r++]=e.charCodeAt(n++);if(r<64)break;this._dataLength+=64,d._md5cycle(this._state,i),r=0;}return this._bufferLength=r,this;}appendByteArray(e){const t=this._buffer8,i=this._buffer32;let s,r=this._bufferLength,n=0;for(;;){for(s=Math.min(e.length-n,64-r);s--;)t[r++]=e[n++];if(r<64)break;this._dataLength+=64,d._md5cycle(this._state,i),r=0;}return this._bufferLength=r,this;}getState(){const e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]};}setState(e){const t=e.buffer,i=e.state,s=this._state;let r;for(this._dataLength=e.length,this._bufferLength=e.buflen,s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],r=0;r<t.length;r+=1)this._buffer8[r]=t.charCodeAt(r);}end(e=!1){const t=this._bufferLength,i=this._buffer8,s=this._buffer32,r=1+(t>>2);let n;if(this._dataLength+=t,i[t]=128,i[t+1]=i[t+2]=i[t+3]=0,s.set(d.buffer32Identity.subarray(r),r),t>55&&(d._md5cycle(this._state,s),s.set(d.buffer32Identity)),n=8*this._dataLength,n<=4294967295)s[14]=n;else{const e=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),i=parseInt(e[1],16)||0;s[14]=t,s[15]=i;}return d._md5cycle(this._state,s),e?this._state:d._hex(this._state);}}var h,l,c;d.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),d.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),d.hexChars="0123456789abcdef",d.hexOut=[],d.onePassHasher=new d(),"5d41402abc4b2a76b9719d911017c592"!==d.hashStr("hello")&&console.error("Md5 self test failed."),function(e){e.createSign=function(e){let t=function(e){e=e||{};let t=Object.keys(function(e){let t,i,s,r={},n=[],a={};for(s in t=function(e,t){let i=parseFloat(e),s=parseFloat(t),r=i+""===e,n=s+""===t;return r&&n?i>s?1:i<s?-1:0:r&&!n?1:!r&&n?-1:e>t?1:e<t?-1:0;},e)e.hasOwnProperty(s)&&n.push(s);for(n.sort(t),i=0;i<n.length;i++)s=n[i],r[s]=e[s];for(i in r)r.hasOwnProperty(i)&&(a[i]=r[i]);return a;}(e)),i="",s="";for(let r=0,n=t.length;r<n;r++)e[t[r]]&&"0"!==e[t[r]]&&"ver"!==t[r]&&"pkv"!==t[r]&&(i=t[r],r&&(s+=""),e[i]instanceof Array?s+=`${i}=${JSON.stringify(e[i])}`:s+=`${i}=${e[i]}`);return s;}(e)+""+s.appkey;return d.hashStr(t);};}(h||(h={}));class u{constructor(){this._startCb=null,this._endCb=null;}_init(){}setCb(e,t){this._startCb=e,this._endCb=t;}_httpRequest(e,t,r){return i(this,arguments,void 0,function*(e,t,i,r="json"){this._startCb&&this._startCb();let n=yield new Promise(r=>{if(i=Object.assign(Object.assign({},i),{ver:s.version,gameid:s.game_id,sign_type:"md5",time_stamp:Math.floor(Date.now()/1e3)+""}),(i=Object.assign(Object.assign({},i),{sign:h.createSign(i)}))&&"object"==typeof i&&(i=JSON.stringify(i)),i=i||"","GET"==t&&""!=i){i=JSON.parse(i);let t="";for(let e in i)t=t+`${e}=`+`${i[e]}&`;e+="?"+t,i="";}let n=new XMLHttpRequest();n.onreadystatechange=()=>{if(4==n.readyState)if(n.status>=200&&n.status<400){let t=n.responseText||n.response;if("string"==typeof t){if(""==t)r({code:0,data:"",msg:"请求成功！"});else try{t=JSON.parse(t),e.indexOf(".json")>-1?r({code:0,data:t,msg:t.msg,servertime:t.servertime}):r({code:+t.code,data:t.data,ip:t.ip,msg:t.msg,servertime:t.servertime});}catch(e){r({msg:"JSON parse error:"+e.message,code:-1});}}else r("object"==typeof t?{code:+t.code,data:t.data,ip:t.ip,msg:t.msg,servertime:t.servertime}:{code:-5,msg:"网络数据转换异常！"});}else r({code:-5,msg:"网络请求失败！"});},n.ontimeout=e=>{r({msg:"请求超时！",code:-2});},n.onerror=e=>{r({msg:"请求失败！",code:-3});},n.onabort=e=>{r({msg:"请求失败！",code:-4});},n.timeout=3e3,setTimeout(()=>{1==n.readyState&&0==n.status&&r({code:-1,msg:"可能是404 支付宝无法捕获"});},3e3),n.open(t,e,!0),"POST"==t&&n.setRequestHeader("Content-Type","application/json;charset=utf-8");try{n.send(i);}catch(e){console.log(e);}});return this._endCb&&this._endCb(n),n;});}get(e,t,s){return i(this,arguments,void 0,function*(e,t,i,s="json"){return t=this._caluUrl(e,t),yield this._httpRequest(t,"GET",i,s);});}_caluUrl(e,t){if(t.includes("{{")){let e=t.split("{{");for(let t=1;t<e.length;t++){let i=e[t].indexOf("}}");if(i>-1){let r=e[t].substring(0,i);"gameid"==r&&(e[t]=e[t].replace(r+"}}",s.game_id));}}t=e.join("");}return t="/"!=e[e.length-1]&&"/"!=t[0]?e+"/"+t:e+t;}post(e,t,s){return i(this,arguments,void 0,function*(e,t,i,s="json"){return t=this._caluUrl(e,t),yield this._httpRequest(t,"POST",i,s);});}}class m{constructor(){this._canUsed=!1;}init(e=s.interstitialAdId){console.log("不支持平台,初始化插屏广告");}show(e=s.interstitialAdId){console.log("不支持平台,显示插屏广告");}}!function(e){var t,i,s,r,n,a,o,d,h,l,c,u,m,g,_,p,y,S,f,v;!function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.Critical=4]="Critical";}(e.LogLevel||(e.LogLevel={})),(t=e.E_MailStatus||(e.E_MailStatus={}))[t.Read=1]="Read",t[t.Reward=2]="Reward",t[t.Delete=3]="Delete",e.ErrorCode={UnKnow:{code:1001,msg:"未知错误"},InvalidLogin:{code:1e4,msg:"登陆失效"}},e.ShareVideoError={VideoQuit:{code:1e3,msg:"要看完视频哦!"},VideoFail:{code:1001,msg:"视频广告加载失败!"},VideoWatchMax:{code:1010,msg:"查看次数过多，请稍后再看!"},VideoInvalid:{code:999,msg:"视频UID不存在!"},VideoNotOpen:{code:1002,msg:"视频组件未开放!"},VideoPlaying:{code:1003,msg:"正在观看视频中..."},ShareFail:{code:1004,msg:"分享失败，请尝试发送至不同群!"},ShareSame:{code:1005,msg:"别总骚扰这个群，换个群分享吧!"},ShareNotGroup:{code:1006,msg:"请分享到群哦!"},NotNet:{code:1007,msg:"网络错误~"},ShareRuleFail:{code:1008,msg:"分享失败，请尝试发送至不同群!"},ShareOverLimit:{code:1009,msg:"今日已达分享上限次数，请明日再来"}},e.BannerError={BannerInvalid:{code:1e3,msg:"广告 uid不能为空!"},BannerFail:{code:1001,msg:"加载广告失败!"},BannerNotOpen:{code:1002,msg:"加载广告失败!"}},e.SceneCode={WX_STORE:1104,WX_SHARE_FRIEND:1007,WX_SHARE_GROUP:1008,WX_SHARE_TICKET:1044,WX_INTEGRAL:1139},e.SDKDotType={Share:1001},(i=e.UserState||(e.UserState={}))[i.Default=0]="Default",i[i.Old=1]="Old",i[i.New=2]="New",(s=e.RankType||(e.RankType={}))[s.Forever=0]="Forever",s[s.Day=1]="Day",s[s.Week=2]="Week",s[s.Month=3]="Month",(r=e.AdType||(e.AdType={}))[r.Default=0]="Default",r[r.Draw=1]="Draw",r[r.GuessLike=2]="GuessLike",r[r.Grid=3]="Grid",r[r.Play=4]="Play",(n=e.VersionEnv||(e.VersionEnv={}))[n.PRE=1]="PRE",n[n.STAGE=2]="STAGE",(a=e.STATUS||(e.STATUS={}))[a.ONLINE=1]="ONLINE",a[a.OFFLINE=2]="OFFLINE",(o=e.ShareVideoType||(e.ShareVideoType={}))[o.None=-1]="None",o[o.Share=1]="Share",o[o.Video=2]="Video",o[o.VideoToShare=3]="VideoToShare",(d=e.Gender||(e.Gender={}))[d.Invalid=-1]="Invalid",d[d.Unknown=0]="Unknown",d[d.Male=1]="Male",d[d.Female=2]="Female",(h=e.BannerStat||(e.BannerStat={}))[h.Click=0]="Click",h[h.Cancel=-1]="Cancel",(l=e.ShareVideoFrom||(e.ShareVideoFrom={}))[l.None=0]="None",l[l.Share=1]="Share",l[l.ShareAysnc=2]="ShareAysnc",l[l.Video=3]="Video",(c=e.TacticType||(e.TacticType={}))[c.ShareLaunch=10]="ShareLaunch",c[c.ShareInterrupt=11]="ShareInterrupt",c[c.ShareSuccess=12]="ShareSuccess",c[c.ShareEnterLaunch=13]="ShareEnterLaunch",c[c.ShareEnterGame=14]="ShareEnterGame",c[c.VideoFetchSuccess=20]="VideoFetchSuccess",c[c.VideoPlayInterrupt=21]="VideoPlayInterrupt",c[c.VideoPlayComplete=22]="VideoPlayComplete",c[c.VideoFetchFail=23]="VideoFetchFail",c[c.InterstitialAdSuccess=30]="InterstitialAdSuccess",c[c.InterstitialAdFail=31]="InterstitialAdFail",(u=e.DOT_SHARE_TYPE||(e.DOT_SHARE_TYPE={}))[u.Default=0]="Default",u[u.Share=1]="Share",u[u.Click=2]="Click",(m=e.DOT_AD_TYPE||(e.DOT_AD_TYPE={}))[m.Default=0]="Default",m[m.Banner=1]="Banner",m[m.Video=2]="Video",m[m.Interstitial=3]="Interstitial",m[m.Grid=4]="Grid",m[m.Custom=5]="Custom",(g=e.DOT_AD_STATUS||(e.DOT_AD_STATUS={}))[g.Default=0]="Default",g[g.Request=1]="Request",g[g.Rt=2]="Rt",g[g.Show=3]="Show",g[g.Click=4]="Click",g[g.Complete=5]="Complete",g[g.Interrupt=6]="Interrupt",g[g.Fail=7]="Fail",(_=e.NetworkType||(e.NetworkType={})).Wifi="wifi",_["2g"]="2g",_["3g"]="3g",_["4g"]="4g",_.Unknown="unknown",_.None="none",(p=e.PayType||(e.PayType={}))["未指定支付方式"]="0",p["H5客服支付"]="1",p["米大师"]="3",p["跳转小程序"]="4",p["二维码小程序"]="5",p["二维码支付"]="6",p["字节钱包"]="7",p["QQ钱包"]="8",p["华为钱包"]="9",p["支付宝小游戏"]="10",p["支付宝小程序"]="11",p["美团支付"]="13",p["微信支付链接"]="14",p["淘宝支付"]="20",p["抖音支付Android"]="21",p["抖音支付IOS"]="22",(y=e.OrderStatus||(e.OrderStatus={}))[y["订单未支付"]=0]="订单未支付",y[y["订单已支付但未领取"]=1]="订单已支付但未领取",y[y["订单已领取"]=2]="订单已领取",y[y["订单已过期"]=3]="订单已过期",(S=e.LoginState||(e.LoginState={}))[S.UnLogin=0]="UnLogin",S[S.Logined=1]="Logined",S[S.Logining=2]="Logining",(f=e.InitState||(e.InitState={}))[f.None=0]="None",f[f.End=1]="End",f[f.Ing=2]="Ing",f[f.Error=3]="Error",(v=e.Env||(e.Env={}))["微信"]="微信",v["支付宝"]="支付宝",v["淘宝"]="淘宝",v["浏览器"]="浏览器",v["抖音"]="抖音";}(l||(l={}));class g{}g.Version=(...e)=>te.Http.post(`${r.Version}`,n.Version,...e),g.ShareList=(...e)=>te.Http.post(te.DataService.GameApi,n.ShareList,...e),g.getConfig=(...e)=>te.Http.post(te.DataService.GameApi,n.getConfig,...e),g.sendsubscribe=(...e)=>te.Http.post(te.DataService.GameApi,n.sendsubscribe,...e),g.cancelSubscribe=(...e)=>te.Http.post(te.DataService.GameApi,n.cancelSubscribe,...e),g.saveData=(...e)=>te.Http.post(te.DataService.GameApi,n.saveData,...e),g.getData=(...e)=>te.Http.post(te.DataService.GameApi,n.getData,...e),g.headSet=(...e)=>te.Http.post(te.DataService.GameApi,n.headSet,...e),g.rankAdd=(...e)=>te.Http.post(te.DataService.GameApi,n.rankAdd,...e),g.rankList=(...e)=>te.Http.post(te.DataService.GameApi,n.rankList,...e),g.rankAddV2=(...e)=>te.Http.post(te.DataService.GameApi,n.rankAddV2,...e),g.rankListV2=(...e)=>te.Http.post(te.DataService.GameApi,n.rankListV2,...e),g.adList=(...e)=>te.Http.post(te.DataService.GameApi,n.adList,...e),g.behavior=(...e)=>te.Http.post(te.DataService.GameApi,n.behavior,...e),g.dy2wxReport=(...e)=>te.Http.post(te.DataService.GameApi,n.dy2wxReport,...e),g.wxEstimate=(...e)=>te.Http.post(te.DataService.GameApi,n.wxEstimate,...e),g.attribute=(...e)=>te.Http.post(te.DataService.GameApi,n.attribute,...e),g.checkmsg=(...e)=>te.Http.post(te.DataService.GameApi,n.checkmsg,...e),g.Login=(...e)=>te.Http.post(te.DataService.LoginApi,n.Login,...e),g.reftoken=(...e)=>te.Http.post(te.DataService.LoginApi,n.Reftoken,...e),g.weakLogin=(...e)=>te.Http.post(te.DataService.LoginApi,n.weakLogin,...e),g.getServerTime=(...e)=>te.Http.post(te.DataService.GameApi,n.serverTime,...e),g.updateNickname=(...e)=>te.Http.post(te.DataService.GameApi,n.updateNickname,...e),g.wxencrypted=(...e)=>te.Http.post(te.DataService.GameApi,n.wxencrypted,...e),g.tbAwardAd=(...e)=>te.Http.post(te.DataService.GameApi,n.tbAwardAd,...e),g.receiveTbAward=(...e)=>te.Http.post(te.DataService.GameApi,n.receiveTbAward,...e),g.douyinFeedAdd=(...e)=>te.Http.post(te.DataService.GameApi,n.douyinFeedAdd,...e),g.douyinFeedCard=(...e)=>te.Http.post(te.DataService.GameApi,n.douyinFeedCard,...e),g.wxDecryption=(...e)=>te.Http.post(te.DataService.GameApi,n.wxDecryption,...e),g.logOut=(...e)=>te.Http.get(te.DataService.DotApi,n.logOut,...e),g.loadingFinish=(...e)=>te.Http.get(te.DataService.DotApi,n.loadingFinish,...e),g.active=(...e)=>te.Http.get(te.DataService.DotApi,n.Active,...e),g.share=(...e)=>te.Http.get(te.DataService.DotApi,n.Share,...e),g.adStat=(...e)=>te.Http.get(te.DataService.DotApi,n.AdStat,...e),g.stay=(...e)=>te.Http.get(te.DataService.DotApi,n.stay,...e),g.behaviors=(...e)=>te.Http.get(te.DataService.DotApi,n.behaviors,...e),g.dot=(...e)=>te.Http.get(te.DataService.DotApi,n.dot,...e),g.jumps=(...e)=>te.Http.get(te.DataService.DotApi,n.jumps,...e),g.level=(...e)=>te.Http.get(te.DataService.DotApi,n.level,...e),g.role=(...e)=>te.Http.get(te.DataService.DotApi,n.role,...e),g.client_log=(...e)=>te.Http.get(te.DataService.DotApi,n.client_log,...e),g.consume=(...e)=>te.Http.get(te.DataService.DotApi,n.consume,...e),g.daystay=(...e)=>te.Http.get(te.DataService.DotApi,n.daystay,...e),g.goodsList=(...e)=>te.Http.post(te.DataService.GameApi,n.goodsList,...e),g.createOrder=(...e)=>te.Http.post(te.DataService.GameApi,n.createOrder,...e),g.queryOrder=(...e)=>te.Http.post(te.DataService.GameApi,n.queryOrder,...e),g.confirmOrder=(...e)=>te.Http.post(te.DataService.GameApi,n.confirmOrder,...e),g.preorder=(...e)=>te.Http.post(te.DataService.OrderApi,n.preorder,...e),g.payReport=(...e)=>te.Http.post(te.DataService.OrderApi,n.orderReport,...e),g.aliMission=(...e)=>te.Http.post(te.DataService.GameApi,n.aliMission,...e),g.alipayIntergralAuth=(...e)=>te.Http.post(te.DataService.GameApi,n.alipayIntergralAuth,...e),g.alipayIntergralQuery=(...e)=>te.Http.post(te.DataService.GameApi,n.alipayIntergralQuery,...e),g.alipayIntergralBuy=(...e)=>te.Http.post(te.DataService.GameApi,n.alipayIntergralBuy,...e),g.isAddHomePage=(...e)=>te.Http.post(te.DataService.GameApi,n.isAddHomePage,...e),g.notice=(...e)=>te.Http.post(te.DataService.GameApi,n.notice,...e),g.email=(...e)=>te.Http.post(te.DataService.GameApi,n.mail,...e),g.emailStatus=(...e)=>te.Http.post(te.DataService.GameApi,n.mailStatus,...e),function(e){function t(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate();}e.timestampToDate=function(e){return new Date(e.replace(/\-/g,"/"));},e.timestampToServerDate=function(e){return`${e.getFullYear()}-${("0"+(e.getMonth()+1)).slice(-2)}-${("0"+e.getDate()).slice(-2)} ${("0"+e.getHours()).slice(-2)}:${("0"+e.getMinutes()).slice(-2)}:${("0"+e.getSeconds()).slice(-2)}`;},e.deepCopy=function(e){return JSON.parse(JSON.stringify(e));},e.deepReplace=function e(t,i){for(let s in i)null!=t[s]&&("object"==typeof i[s]?e(t[s],i[s]):i[s]=t[s]);},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");let i=Math.max(e.length,t.length);for(;e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(let s=0;s<i;s++){let i=parseInt(e[s]),r=parseInt(t[s]);if(i>r)return 1;if(i<r)return-1;}return 0;},e.isSameDayForDate=t,e.isSameDayForTime=function(e,i){return t(new Date(e),new Date(i));},e.randomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e;};}(c||(c={}));class _{constructor(){this._isWeek=!1,this._ip=!1,this._loginState=l.LoginState.UnLogin,this._loginResolveArr=[],this._freshTokenTime=0,this._freshTokenFlag=!0,this._recordResult=null;}get isWeek(){return this._isWeek;}get isLogin(){return this._loginState==l.LoginState.Logined;}awaitLogin(){return this._loginState==l.LoginState.Logined?this._recordResult:new Promise(e=>{this._loginResolveArr.push(e);});}getUrlMsg(){let e=window.location.search;if(!e)return{};let t=e.split("?")[1],i={};if(t){let e=t.split("&");for(let t=0;t<e.length;t++){let s=e[t].split("=");i[s[0]]=s[1];}}return i;}init(){let e=this.getUrlMsg();this._testOpenId=e.openId||"测试",this._testCodeId=e.code||"测试",te.EventCenter.on(te.EventCenter.SECOND_CHANGE,this._onTimeLoop,this);}loginWithOpenId(e){e&&(this._testOpenId=e,this._testCodeId=e),this.login(!1);}login(e){return i(this,arguments,void 0,function*(e,t=!1){return this._loginState==te.EnumConst.LoginState.Logined&&this._isWeek!=e?Promise.resolve({code:0,msg:"已经登录"}):(this._ip=t||!1,this._loginResolveArr.length=0,this._loginState=te.EnumConst.LoginState.Logining,yield te.awaitInit(),new Promise(t=>i(this,void 0,void 0,function*(){let i=yield te.Platform.login(e);te.__LOG__&&console.log("授权信息:",i);let s=0==i.code?i.data.authCode:null;if(e&&s){let e=yield te.Platform.getUserInfo();e.code?this._weakLogin({errCode:1,msg:"获得授权登录失败"},s,t):this._authedlogin(e.data,i.data.authCode,t);}else this._weakLogin({errCode:1,msg:"默认未授权登录"},s,t);})));});}_authedlogin(e,t,s){return i(this,void 0,void 0,function*(){this._isWeek=!1;let i=this._buildParams();if(i.code=t,"web"==i.platform&&(i.test_openid=this._testOpenId,i.code=this._testCodeId),e.signature&&(i.signature=e.signature),e.iv&&(i.iv=e.iv),e.encryptedData&&(i.encryptedData=e.encryptedData),e.avatar||e.nickName||e.nick){let t={headurl:e.avatar,nickname:e.nickName?e.nickName:e.nick};i.encryptedData=JSON.stringify(t);}g.Login(i).then(e=>{te.__LOG__&&console.log("登录请求结果data",e),0==e.code?(this._loginState=l.LoginState.Logined,this._handleLogin(e),s(e),this._dealResolve(e)):(this._loginState=l.LoginState.UnLogin,s(e),this._dealResolve(e));});});}_weakLogin(e,t,s){return i(this,void 0,void 0,function*(){if(!e||e.errCode===l.ErrorCode.InvalidLogin.code)return;this._isWeek=!0;let i=this._buildParams();i.code=t,"web"==i.platform&&(i.test_openid=this._testOpenId,i.code=this._testCodeId),g.weakLogin(i).then(e=>{te.__LOG__&&console.log("登录请求结果data",e),0==e.code?(this._loginState=l.LoginState.Logined,this._handleLogin(e),s(e),this._dealResolve(e)):(this._loginState=l.LoginState.UnLogin,s(e),this._dealResolve(e));});});}_handleLogin(e){if(null==e.data)return;let t,i=e.data;try{t=JSON.parse(i.ad_info);}catch(e){t={};}te.DataService.updateData({channelId:i.channel,uid:i.uid,regDate:c.timestampToDate(i.first_login_time?i.first_login_time:i.firstlogin),openid:i.openid,isnew:i.isnew,token:i.token,refToken:i.reftoken,expire:i.expire,logindays:i.logindays,amount:i.amount,pon:i.pon,ptm:i.ptm,userinfo:i.userinfo,gender:i.userinfo.gender,ad_info:t}),e.ip&&te.DataService.setCity(e.ip.city),te.EventCenter.emit(te.EventCenter.USER_INFO_UPDATE),te.OnlineService.setData(i.gameconfig),te.Analytics.setLogind(),!this._isFirst&&te.DataService.shareKey&&te.DataService.shareId&&(this._isFirst=!0,te.Analytics.share(te.DataService.shareKey,te.DataService.shareId,te.EnumConst.DOT_SHARE_TYPE.Click)),this._handleExpire(i.expire);}_buildParams(){let e=te.DataService.queryChannelId,t=te.Platform.getSystemInfoSync(),i=t.brand,s=t.model,r=t.version,n=t.system,a=t.platform,o=t.SDKVersion,d=te.DataService.scene+"",h=te.DataService.shareKey,l=te.DataService.shareId+"";return{channel:e,brand:i,model:s,version:r,system:n,platform:a,sdkversion:o,shareuid:Number(te.DataService.queryUserInviteUid),scene:d,sharekey:h,shareid:l,clue_token:te.DataService.clue_token,creative_id:te.DataService.creative_id,advertister_id:te.DataService.advertister_id,request_id:te.DataService.request_id,ip:this._ip?"1":"",launch_data:JSON.stringify(te.Platform.getLaunchOptionsSync())};}_handleExpire(e){this._freshTokenFlag=!1,this._freshTokenTime=e;}_onTimeLoop(e,t){this._freshTokenFlag||t>=this._freshTokenTime&&this._refreshToken();}_refreshToken(){this._freshTokenFlag=!0,g.reftoken({channel:te.DataService.channelId+"",uid:te.DataService.uid,token:te.DataService.token,reftoken:te.DataService.refToken}).then(e=>{if(0==e.code){let{token:t,reftoken:i,expire:s}=e.data;te.DataService.updateData({token:t,refToken:i,expire:s}),this._handleExpire(s);}});}_dealResolve(e){this._recordResult=e;for(let t of this._loginResolveArr)t(e);}}class p{getGoodslist(){return 0==te.Login.isLogin?Promise.resolve({code:-1,msg:"未登录"}):g.goodsList({uid:te.DataService.uid,token:te.DataService.token});}createOrder(e,t){return i(this,void 0,void 0,function*(){return 0==te.Login.isLogin?Promise.resolve({code:-1,msg:"未登录"}):g.createOrder({uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid,channel:te.DataService.queryChannelId,platform:te.Platform.getSystemInfoSync().platform,good_id:e,thirdno:t});});}payReport(e){return i(this,void 0,void 0,function*(){return 0==te.Login.isLogin?Promise.resolve({code:-1,msg:"未登录"}):g.payReport(e);});}getPayOrderInfo(e,t){return i(this,void 0,void 0,function*(){if(0==te.Login.isLogin)return Promise.resolve({code:-1,msg:"未登录"});let i=this._buildParams();return i.good_id=e,i.orderid=t,i.token=te.DataService.token,g.preorder(i);});}tryPay(e,t){return i(this,void 0,void 0,function*(){if(0==te.Login.isLogin)return Promise.resolve({code:-1,msg:"未登录"});let t=yield this.createOrder(e);if(te.__LOG__&&console.log("创建订单:",t),0==t.code){let i,s=yield this.getPayOrderInfo(e,t.data.no);if(te.__LOG__&&console.log("获取订单类型:",s),0==s.code){let r=yield this._payInPlatform(s.data,e,t.data.no);te.__LOG__&&console.log("支付结果:",r),i=r;}else i=s;return null==i.data&&(i.data={}),i.data.order_id=t.data.no,i;}return t;});}retryPay(e,t){return i(this,void 0,void 0,function*(){if(0==te.Login.isLogin)return Promise.resolve({code:-1,msg:"未登录"});let i=this._buildParams();i.good_id=e,i.orderid=t,i.token=te.DataService.token;let s=yield g.preorder(i);if(te.__LOG__&&console.log("获取订单类型:",s),0==s.code){let i=yield this._payInPlatform(s.data,e,t);return te.__LOG__&&console.log("支付结果:",i),i;}return s;});}queryOrder(e){return 0==te.Login.isLogin?Promise.resolve({code:-1,msg:"未登录"}):(e instanceof Array&&(e=e.join(",")),g.queryOrder({uid:te.DataService.uid,token:te.DataService.token,no:e}));}confirmOrder(e){return 0==te.Login.isLogin?Promise.resolve({code:-1,msg:"未登录"}):g.confirmOrder({uid:te.DataService.uid,token:te.DataService.token,no:e});}_payInPlatform(e,t,i){let{config:s,paytype:r}=e;switch(s||(s={}),r){case te.EnumConst.PayType.未指定支付方式:return Promise.resolve({code:-1,msg:"未指定支付方式"});case te.EnumConst.PayType.H5客服支付:return this._payFromH5Customer(s);case te.EnumConst.PayType.跳转小程序:return this._payFromJumpMiniApp(s);case te.EnumConst.PayType.二维码小程序:return this._payFromQRMiniApp(s);case te.EnumConst.PayType.二维码支付:return this._payFromQRPay(s);case te.EnumConst.PayType.米大师:case te.EnumConst.PayType.QQ钱包:case te.EnumConst.PayType.字节钱包:case te.EnumConst.PayType.支付宝小游戏:case te.EnumConst.PayType.美团支付:case te.EnumConst.PayType.淘宝支付:return this._payFromWallet(s,t,i);case te.EnumConst.PayType.抖音支付IOS:case te.EnumConst.PayType.抖音支付Android:return this._payFromWallet(e.pay_request_data,t,i);default:return Promise.resolve({code:-1,msg:"未知支付类型"+e.paytype});}}_payFromH5Customer(e){return new Promise(t=>i(this,void 0,void 0,function*(){var{img:i,title:s,path:r}=e;let n=yield te.Platform.openCustomerServiceConversation({showMessageCard:!0,sendMessageTitle:s||"我要充值！",sendMessagePath:r,sendMessageImg:i||"http://dep.miso-lab.com/idiom/bin/share/getLive.png"});0==n.code?(n.data.msg="打开客服会话成功",t(n)):t(n);}));}_payFromJumpMiniApp(e){return new Promise(t=>i(this,void 0,void 0,function*(){var{appid:i,page:s}=e;let r=yield te.Platform.navigateToMiniProgram({appId:i,path:s,envVersion:te.DataService.envEnum===l.VersionEnv.STAGE?"release":"trial"});0==r.code?(r.data.msg="跳转小程序成功",t(r)):t(r);}));}_payFromQRMiniApp(e){return i(this,void 0,void 0,function*(){var{imgurl:t}=e;let i=yield te.Platform.previewImage({urls:[t],current:t});return 0==i.code?(i.data.msg="展示二维码成功",i):i;});}_payFromQRPay(e){return i(this,void 0,void 0,function*(){var{qrcode:t}=e;let i=yield te.Platform.previewImage({current:t,urls:[t]});return 0==i.code?(i.data.msg="展示二维码成功",i):i;});}_payFromWallet(e,t,i){return Promise.resolve({code:-1,msg:"暂不支持"});}_buildParams(){let e=s.game_id,t=te.Platform.getSystemInfoSync(),i=t.brand,r=t.model,n=t.version,a=t.system,o=t.platform,d=t.SDKVersion,h=te.DataService.channelId;return{gameid:e,openid:te.DataService.openid,channel:h,brand:i,model:r,version:n,system:a,sdkversion:d,scene:te.DataService.scene+"",uid:te.DataService.uid,token:te.DataService.token,env:1===te.DataService.envEnum?"pre":"prod",platform:o};}}function y(e,t){return function(i,s,r){null==e&&(e=s);let n=r.value;r.value=function(...r){return null==this._env||f(this._env,e)?n.apply(this,r):t?void console.log(t):i.__proto__[s].apply(this,r);};};}const S={};function f(e,t){if(null!=S[t])return S[t];let i=t.split(".");for(let s of i){if(null==e[s])return S[t]=!1,!1;e=e[s];}return S[t]=!0,!0;}class v{constructor(){this._env=null,this._pixelScale=1,this.shake=!0;}init(e){e.pixelScale&&(this._pixelScale=e.pixelScale),e.safaArea&&(this._targetSafeArea=e.safaArea),e.menuBtnArea&&(this._menuButtonArea=e.menuBtnArea);}vibrateShort(e="light"){console.log("模拟短震动 强度:"+e);}vibrateLong(){console.log("模拟长震动");}getSystemInfoSync(e=!1){return!e&&this._systemInfo||(this._systemInfo=this._getSystemInfoInPlatform()),this._systemInfo;}_getSystemInfoInPlatform(){return{model:"测试",pixelRatio:1,screenWidth:750,screenHeight:1134,windowWidth:750,windowHeight:1334,statusBarHeight:50,platform:"web",language:"zh",version:"1.0.0",system:"web",SDKVersion:"1.0.0",brand:"",fontSizeSetting:16};}getLaunchOptionsSync(){return{query:{},referrerInfo:{}};}getWindowInfoSync(e=!1){return(e||null==this._windowInfo)&&(this._windowInfo=this._getWindowInfoInPlatform(),this._windowInfo&&this._windowInfo.safeArea&&(this._targetSafeArea=c.deepCopy(this._windowInfo.safeArea),this._targetSafeArea.width*=this._pixelScale,this._targetSafeArea.height*=this._pixelScale,this._targetSafeArea.right*=this._pixelScale,this._targetSafeArea.bottom*=this._pixelScale,this._targetSafeArea.top*=this._pixelScale,this._targetSafeArea.left*=this._pixelScale,console.log("safeArea",this._targetSafeArea))),this._windowInfo;}_getWindowInfoInPlatform(){return{pixelRatio:0,screenHeight:0,screenWidth:0,statusBarHeight:0,windowHeight:0,windowWidth:0};}getSafeAreaTop(){return this._targetSafeArea.top;}getSafeAreaBottom(){return this.getWindowInfoSync().screenHeight*this._pixelScale-this._targetSafeArea.bottom;}showToast(e,t="none",i=1500){console.log("showToast 不支持",e);}showModal(e){return Promise.resolve({code:-1,msg:"showModal 不支持"});}showBannerAd(){}requestSubscribeMessage(e){return Promise.resolve({code:-1,msg:"subscribeMessage 不支持"});}requestSubscribeSystemMessage(e){return Promise.resolve({code:-1,msg:"requestSubscribeSystemMessage 不支持"});}getUserInfo(){return Promise.resolve({code:-1,msg:"getUserInfo 不支持"});}createUserInfoButton(e){return this._createWebButton();}login(e){return console.log("web环境没有login接口"),Promise.resolve({code:-1,data:{authCode:1},msg:"success"});}getSetting(e=!0){return Promise.resolve({code:-1,msg:"getSetting 不支持"});}setMessageToFriendQuery(e,t){return{code:-1,msg:"MessageToFriendQuery 不支持"};}onShareAppMessage(e){return Promise.resolve({code:-1,msg:"onShareAppMessage 不支持"});}showShareMenu(e){console.log("showShareMenu 不支持");}shareAppMessage(e){return Promise.resolve({code:-1,msg:"分享 不支持"});}updateShareMenu(e){console.log("updateShareMenu 不支持");}navigateToMiniProgram(e){return Promise.resolve({code:-1,msg:"navigateToMiniProgram 不支持"});}onShow(e){console.log("onShow 不支持");}offShow(e){console.log("offShow 不支持");}onHide(e){console.log("onHide 不支持");}offHide(e){console.log("offHide 不支持");}getNetworkType(){return Promise.resolve({networkType:l.NetworkType.Unknown,isConnected:!0});}onNetworkStatusChange(e){console.log("检测网络状态 不支持");}openCustomerServiceConversation(e){return Promise.resolve({code:-1,msg:"客服对话 不支持"});}previewImage(e){return Promise.resolve({code:-1,msg:"previewImage 不支持"});}requestPayment(e){return Promise.resolve({code:-1,msg:" 原生充值 不支持"});}createInterstitialAd(e){return{};}createRewardedVideoAd(e){return{};}createCustomAd(e){return console.log("不支持平台创建定制广告"),{};}createGameBanner(e){return console.log("不支持平台创建Banner"),{};}createGameIcon(e){return console.log("不支持平台创建小游戏Icon"),{};}getShareInfo(e){return Promise.resolve({code:-1,msg:"getShareInfo 不支持"});}createGameClubButton(e){return this._createWebButton();}createFeedbackButton(e){return this._createWebButton();}checkUpdate(e){return Promise.resolve({code:-1,msg:"getUpdateManager 不支持"});}setClipboardData(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{return document.execCommand("copy"),document.body.removeChild(t),Promise.resolve({code:-1,msg:"setClipboardData 成功",data:e});}catch(e){return document.body.removeChild(t),Promise.resolve({code:-1,msg:"setClipboardData 不支持"});}}getClipboardData(){return Promise.resolve({code:-1,msg:"getClipboardData 不支持"});}postMessageToOpenDataContext(e){return Promise.resolve({code:-1,msg:"开放域 不支持"});}setUserCloudStorage(e){return Promise.resolve({code:-1,msg:"setUserCloudStorage 不支持"});}setImRankData(e){}getImRankList(){}reportScene(e){console.log("不支持reportScene");}navigateLimitUrl(e){console.log("不支持navigateLimitUrl");}checkIsAddedToMyMiniProgram(){return Promise.resolve({code:-1,msg:"不支持checkIsAddedToMyMiniProgram"});}onMemoryWarning(e){console.log("不支持onMemoryWarning");}offMemoryWarning(e){console.log("不支持offMemoryWarning");}triggerGC(){console.log("不支持triggerGC");}getGameClubData(e){return Promise.resolve({code:-1,msg:"getGameClubData 不支持"});}restartGame(){window.location.reload();}exitGame(){window.close();}showLoading(e,t=!1){return Promise.resolve({code:-1,msg:"showLoading 不支持"});}hideLoading(){return Promise.resolve({code:-1,msg:"hideLoading 不支持"});}uploadFile(e){return Promise.resolve({code:-1,msg:"uploadFile 不支持"});}chooseMedia(e){return Promise.resolve({code:-1,msg:"chooseMedia 不支持"});}getStorageLength(){return localStorage.length;}getStorageItem(e){return localStorage.getItem(e);}setStorageItem(e,t){localStorage.setItem(e,t);}removeStorageItem(e){localStorage.removeItem(e);}clearStorage(){localStorage.clear();}checkSession(){return Promise.resolve({code:-1,msg:"checkSession 不支持"});}_dealBtnStyle(e){null!=e&&(e.width&&(e.width/=this._pixelScale),e.height&&(e.height/=this._pixelScale),e.left&&(e.left/=this._pixelScale),e.top&&(e.top/=this._pixelScale));}_createWebButton(){return console.log("不支持平台模拟按钮"),{show:()=>{},hide:()=>{},destroy:()=>{},onTap:e=>{},offTap:e=>{}};}isSupport(e){return null!=this._env&&f(this._env,e);}_formatMsg(e){let t={code:-1,msg:e.errMsg};return e.errCode?t.code=e.errCode:e.errno?t.code=e.errno:e.errNo&&(t.code=e.errNo),e.errMsg?t.msg=e.errMsg:e.errmsg&&(t.msg=e.errmsg),t;}_formatSubscribeMsg(e){return e.templateSettings&&(e.itemSettings=e.templateSettings,delete e.templateSettings),e;}}class A{constructor(){this._canUsed=!1;}preloadVideo(e=s.videoAd){console.log("不支持平台,预创建激励视频");}show(e,t=s.videoAd){return console.log("不支持平台,显示激励视频"),Promise.resolve(!0);}}class D extends a{constructor(e,t){super(),this.templateWidth=362,this.templateHeight=1500,this.queue=[],this.isEnd=!1,this._isShow=!1,this._onLoad=()=>{this.bannerAd&&(te.__LOG__&&console.warn("Banner onLoad: "+this.adUnitId),this._unbind(),this.handleQueue(),this.resolve&&this.resolve({adUnitId:this.adUnitId,scale:this.bannerScale}));},this._onError=(e,...t)=>{console.warn("Banner onError",e,JSON.stringify(e),t),te.__LOG__&&console.warn("Banner onError",e,JSON.stringify(e),t),!this._isErrored&&this._handleError(e,Object.assign(Object.assign({},te.EnumConst.BannerError.BannerFail),{adUnitId:this.adUnitId}));},e=e||750,t=t||750,this.adUnitId="",this._isErrored=!1,this.designWidth=e;let i=te.Platform.getSystemInfoSync().windowWidth,s=te.Platform.getSystemInfoSync().windowHeight;this.bannerScale=i/this.designWidth;let r=this.bannerScale*t;this.bannerWidth=Math.max(r,300),this.bannerHeight=this.templateWidth/this.templateHeight*this.bannerWidth,this.top=s-this.bannerHeight,this._canUsed=te.Platform.isSupport("createBannerAd");}get isErrored(){return this._isErrored;}create(e=s.bannerId,t=!0,i){return 0==this._canUsed?super.create(e,t,i):(this.bannerParams=i||{},i&&i.bannerWidth&&(this.bannerWidth=i.bannerWidth),this.isEnd=!0,this.bannerParams.type=this.bannerParams.type||1,this.bannerParams.offsetY=-this.bannerParams.offsetY||0,this.bannerParams.adIntervals=this.bannerParams.adIntervals||120,new Promise((i,s)=>{if(this.resolve=i,this.reject=s,this._isErrored=!1,this.adUnitId=e,""==e||null==e)return this.handleQueue(),this.reject(Object.assign(Object.assign({},te.EnumConst.BannerError.BannerInvalid),{adUnitId:this.adUnitId}));2===this.bannerParams.type&&(this.bannerWidth=te.Platform.getSystemInfoSync().windowWidth);let r={top:0,left:(te.Platform.getSystemInfoSync().windowWidth-this.bannerWidth)/2,width:this.bannerWidth};if(r=Object.assign(Object.assign({},r),{top:this.top}),this.bannerAd)t&&this.show(!1);else{if(this.bannerAd=te.Platform.createGameBanner({adUnitId:e,style:r}),te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Request),!this.bannerAd)return this.handleQueue(),this.reject(Object.assign(Object.assign({},te.EnumConst.BannerError.BannerNotOpen),{adUnitId:this.adUnitId}));this.bannerAd.onLoad(this._onLoad),this.bannerAd.onError(this._onError),t&&this.show(!1);}}));}show(e=!0){if(0==this._canUsed)return super.show(e);if(this._isShow)this.handleQueue();else{if(!this.isEnd||!e){if(this.isEnd=!0,this.bannerAd){return 2===this.bannerParams.type&&this.bannerAd.style.width?this.bannerAd.style.left=(te.Platform.getSystemInfoSync().windowWidth-this.bannerAd.style.width)/2:this.bannerAd.style.left=(te.Platform.getSystemInfoSync().windowWidth-this.bannerWidth)/2,te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Show),this._isShow=!0,this.bannerAd.show().then(()=>{this.handleQueue();}).catch(e=>this._handleShowError(e)),te.__LOG__&&console.warn("Banner show: "+this.adUnitId,this.bannerAd.style),this.handleQueue(),!0;}return this.handleQueue(),!1;}this.queue.push(this.show.bind(this));}}hide(){if(0==this._canUsed)return super.hide();this.isEnd?this.queue.push(this.hide.bind(this)):(this._isShow=!1,this.isEnd=!0,this.bannerAd&&(this.bannerAd.style.left=-9999,this.bannerAd.hide(),te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Interrupt),te.__LOG__&&console.warn("Banner hide: "+this.adUnitId)),this.handleQueue());}toggle(e){e?this.show():this.hide();}destory(){var e;if(0==this._canUsed)return super.destory();this.bannerAd&&(this.bannerAd.style.left=-9999,null===(e=this.bannerAd)||void 0===e||e.destroy(),this._isShow=!1,this.bannerAd=null,te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Interrupt),te.__LOG__&&console.warn("Banner destory: "+this.adUnitId));}_onResize(){}_handleShowError(e){console.warn("Banner handleShowError",e),te.__LOG__&&console.warn("Banner handleShowError",e);let{errCode:t,errMsg:i}=e;!this.isErrored&&this._handleError(e,{code:t,msg:i});}_handleError(e,t){var i;this._unbind(),this._isErrored=!0,null===(i=this.bannerAd)||void 0===i||i.destroy(),this._isShow=!1,this.bannerAd=null,this.handleQueue(),te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Fail),this.reject&&this.reject(Object.assign(Object.assign({},t),{adUnitId:this.adUnitId})),te.__LOG__&&console.warn("Banner onError: "+this.adUnitId,e,t);}_unbind(){this.bannerAd;}handleQueue(){if(this.queue.length>0){this.isEnd=!1,this.queue.shift()();}else this.isEnd=!1;}}class w extends m{constructor(){super(),this.interstitialAdId=s.interstitialAdId,this.interstitialSuccell=!1,this._canUsed=te.Platform.isSupport("createInterstitialAd");}init(e=s.interstitialAdId){if(0==this._canUsed)return super.init(e);""!=e&&(this.interstitialAdId=e,this._createInterstitial());}show(e=s.interstitialAdId){return 0==this._canUsed?super.show(e):""!=e?new Promise((t,s)=>i(this,void 0,void 0,function*(){this.interstitialAdId=e,this.interstitialSuccell?this.interstitialAd.show().then(e=>{t&&t({code:0,msg:"展示成功！"}),te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Complete);}).catch(e=>{te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Interrupt),t&&t({code:e.errCode,msg:e.errMsg});}):this._createInterstitial(!0,t);})):void 0;}_createInterstitial(e=!1,t){te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Request),this.interstitialAd=te.Platform.createInterstitialAd({adUnitId:this.interstitialAdId}),this.interstitialAd.onLoad(()=>i(this,void 0,void 0,function*(){this.interstitialSuccell=!0,e&&this.interstitialAd.show().then(e=>{t&&t({code:0,msg:"展示成功！"}),te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Complete);}).catch(e=>{this.interstitialSuccell=!1,te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Interrupt),t&&t({code:e.errCode,msg:e.errMsg});});})),this.interstitialAd.onError(e=>{te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Fail),this.interstitialSuccell=!1,t&&t({code:e.errCode,msg:e.errMsg});}),this.interstitialAd.onClose(e=>{this._createInterstitial(!1);});}}class b extends p{_payFromWallet(e,t,i){return new Promise(s=>{let r=te.Platform.getSystemInfoSync().platform,n=Object.assign(Object.assign({},this._buildParams()),{orderid:i,goodid:t,money:e.money,platform:r});g.payReport(n).then(e=>{if(e.code)s(e);else{let{customId:t,buyQuantity:i,extraInfo:r}=e.data;te.Platform.requestPayment({customId:t,buyQuantity:i,extraInfo:r}).then(e=>{e.code?this._handlePayError(n,e,s):this._handlePaySuccess(n,s);});}});});}_handlePaySuccess(e,t){return i(this,arguments,void 0,function*(e,t,i=1e3){e.type=1;var s=this;g.payReport(e).then(r=>{r.code?(i=Math.min(2*i,6e4),setTimeout(()=>{s._handlePaySuccess(e,t,i);},i)):t(r);});});}_handlePayError(e,t,i){let s=2;t.code+""=="1"&&(s=3),e.type=s,g.payReport(e),i(t);}}class I extends v{constructor(){super(...arguments),this._env=my,this._vibrateShortFlag=!1;}vibrateShort(e="light"){0!=this.shake&&(this._vibrateShortFlag||(this._vibrateShortFlag=!0,this._env.vibrateShort({type:e}),setTimeout(()=>{this._vibrateShortFlag=!1;},100)));}vibrateLong(){0!=this.shake&&this._env.vibrateLong();}restartGame(){console.log("重启游戏 不支持");}showToast(e,t="none",i=1500){if(null==this._env.showToast)return super.showToast(e,t,i);let s="error"==t?"fail":t;this._env.showToast({type:s,content:e,duration:i});}showModal(e){return null==this._env.showModal?super.showModal(e):new Promise(t=>{let i={};e.title&&(i.title=e.title),e.content&&(i.content=e.content),e.confirmText&&(i.confirmButtonText=e.confirmText),e.cancelText&&(i.cancelButtonText=e.cancelText),e.confirmColor&&(i.confirmColor=e.confirmColor),e.cancelColor&&(i.cancelColor=e.cancelColor),i.success=e=>{1==e.confirm?t&&t({code:0,data:e.content,msg:"success"}):t&&t({code:-1,data:e,msg:"fail"});},i.fail=e=>{t&&t({code:-1,data:e,msg:"fail"});},this._env.confirm(i);});}_getSystemInfoInPlatform(){return this._env.getSystemInfoSync();}getLaunchOptionsSync(){return this._env.getLaunchOptionsSync();}_getWindowInfoInPlatform(){return this._env.getWindowInfo();}getUserInfo(){return new Promise(e=>{this._env.getAuthUserInfo({success:t=>{e(t?{code:0,data:t,msg:"success"}:{code:-1,msg:"获得用户信息失败"});},fail:t=>{e({code:-1,msg:"获得用户信息失败"});}});});}login(e){return new Promise(t=>{this._env.getAuthCode({scopes:e?"auth_user":"auth_base",success:e=>{t({code:0,data:{authCode:e.authCode}});},fail:e=>{t({code:e.error,msg:e.errorMessage});}});});}createGameBanner(e){return this._env.createBannerAd(e);}onShareAppMessage(e){return new Promise(t=>{this._env.onShareAppMessage=function(){return Object.assign(Object.assign({},e),{success:e=>{t({code:0,msg:"成功",data:e});},fail:e=>{t({code:e.error,msg:e.errorMessage});}});};});}shareAppMessage(e){return new Promise(t=>(this._env.onShareAppMessage=function(){return{title:e.title,bgImgUrl:e.imageUrl};},this._env.showSharePanel({success:e=>{t({code:0,msg:"成功",data:e});},fail:e=>{t({code:e.error,msg:e.errorMessage});}})));}createRewardedVideoAd(e){return this._env.createRewardedAd(e);}createInterstitialAd(e){return this._env.createInterstitialAd(e);}getNetworkType(){return new Promise(e=>{this._env.getNetworkType({success:t=>{e({isConnected:t.isConnected,networkType:t.networkType.toLowerCase()});},fail:t=>{e({isConnected:!1,networkType:l.NetworkType.Unknown});}});});}onNetworkStatusChange(e){this._env.onNetworkStatusChange(t=>{e&&e({isConnected:t.isConnected,networkType:t.networkType.toLowerCase()});});}navigateToMiniProgram(e){let t;if(e.byScheme){let{params:i,message:s}=this.schemeToParams(e.url);if(null==i)return Promise.resolve({code:-1,msg:s});t=i;}else t=e;return new Promise(e=>{this._env.navigateToMiniProgram(Object.assign(Object.assign({},t),{success:t=>{e({code:0,msg:"success"});},fail:t=>{console.log("跳转小程序失败",t),e({code:t.error,msg:t.errorMessage});}}));});}schemeToParams(e){if(!e.startsWith("alipays:"))return{message:"! 非 alipays: 开头"};var t={};for(var[i,s]of e.replace(/^.*?\?/,"").split("&").map(e=>{var t=e.includes("=")?e.indexOf("="):e.length;return[e.slice(0,t),e.slice(t+1)].map(decodeURIComponent);}))if("appId"==i){if(16!=s.length)return{message:`! 非 16 位 appId '${s}'`};t[i]=s;}else if("chInfo"==i){let e="startParam",r=t[e]||{};r[i]=s,t[e]=r;continue;}return{params:t};}createGameClubButton(e){return this._env.createGameClubButton(e);}previewImage(e){return new Promise(t=>{let i=e.urls.indexOf(e.current);-1==i&&(i=0),this._env.previewImage({current:i,urls:e.urls,enableShowPhotoDownload:e.enableShowPhotoDownload,enableSavePhoto:e.enableSavePhoto,success:e=>{t({code:0,data:e,msg:"success"});},fail:e=>{t({code:-1,msg:e.errMsg});}});});}requestPayment(e){let{customId:t,buyQuantity:i,extraInfo:s}=e;return new Promise(e=>{this._env.requestGamePayment({customId:t,buyQuantity:i,extraInfo:s,success:t=>{console.log("调用函数成功",t),"15215"==t.resultCode?this.showToast("您好，基于国家新闻出版署《关于防止未成年人沉迷网络游戏的通知》的规定，支付宝限制未成年人游戏充值哦"):"15204"==t.resultCode&&this.showToast("非常抱歉，充值功能暂不可用，请稍后再试");["8000","6004","15205","15004"].includes(t.resultCode)?e({code:0,msg:"success"}):e({code:Number(t.resultCode),msg:t.memo});},fail:t=>{console.log("调用函数失败",t),e({code:t.error,msg:t.errorMessage});}});});}setImRankData(e){return new Promise(t=>{this._env.setImRankData(Object.assign(Object.assign({},e),{success:e=>{e.success?t({code:0,msg:"success"}):t({code:e.error,msg:e.errorMessage});},fail:e=>{t({code:e.error,msg:e.errorMessage});}}));});}onShow(e){this._env.onShow(e);}onHide(e){this._env.onHide(e);}offShow(e){this._env.offShow(e);}offHide(e){this._env.offHide(e);}}t([y()],I.prototype,"vibrateShort",null),t([y()],I.prototype,"vibrateLong",null),t([y("getSystemInfoSync")],I.prototype,"_getSystemInfoInPlatform",null),t([y()],I.prototype,"getLaunchOptionsSync",null),t([y("getWindowInfo")],I.prototype,"_getWindowInfoInPlatform",null),t([y("getAuthUserInfo")],I.prototype,"getUserInfo",null),t([y()],I.prototype,"getNetworkType",null),t([y()],I.prototype,"onNetworkStatusChange",null),t([y()],I.prototype,"onShow",null),t([y()],I.prototype,"onHide",null),t([y()],I.prototype,"offShow",null),t([y()],I.prototype,"offHide",null);class T extends A{get isPlaying(){return this._isPlaying;}constructor(){super(),this._isPlaying=!1,this.videoKey="",this.adUnitId="",this.show_time=0,this.cd_time=0,this._handleClose=e=>{let t=e&&e.isEnded||void 0===e;te.__LOG__&&console.warn(t?"激励视频播放成功":"激励视频播放失败");let i=Math.floor((Date.now()-this.show_time)/1e3);t?Date.now()-this.cd_time>3e3&&(this.cd_time=Date.now(),te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Complete,i),this.resolve&&this.resolve({code:0,data:{time:i}})):(te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Interrupt,i),this.reject&&this.reject(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoQuit),{data:{time:i}}))),this.videoAd.load(),this._isPlaying=!1;},this._canUsed=te.Platform.isSupport("createRewardedAd");}preloadVideo(e=s.videoAd){if(0==this._canUsed)return super.preloadVideo(e);let t=this.videoAd;t?t.load().catch(()=>{}):(t=my.createRewardedAd({adUnitId:e}),t.onClose(this._handleClose),t.onError(()=>{}),t.onLoad(()=>i(this,void 0,void 0,function*(){}))),this.videoAd=t;}show(e){const t=Object.create(null,{show:{get:()=>super.show}});return i(this,arguments,void 0,function*(e,r=s.videoAd){return 0==this._canUsed?t.show.call(this,e,r):new Promise((t,s)=>i(this,void 0,void 0,function*(){return this.isPlaying?s(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoPlaying),{data:{time:0}})):r?this.videoAd?(te.Analytics.adStat(e,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Request),this._isPlaying=!0,this.videoKey=e,this.adUnitId=r,this.resolve=t,this.reject=s,te.Analytics.adStat(e,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Show),this.show_time=Date.now(),this.videoAd.show().then(()=>{}).catch(this._handleError),void(te.__LOG__&&console.warn("激励视频请求adUnitId",r))):(this.preloadVideo(r),s(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoFail),{data:{time:0}}))):s(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoInvalid),{data:{time:0}}));}));});}_handleError(e){te.__LOG__&&console.warn("激励视频加载失败",e),te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Fail),this.reject&&(this.videoAd?this.reject(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoFail),{data:{time:0}})):this.reject(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoWatchMax),{data:{time:0}}))),this._isPlaying=!1;}}class P extends u{constructor(){super(),this._cloud=window._taobaoCloud,null==this._cloud?my&&my.showToast({type:"警告",content:"淘宝网络通讯环境不存在",duration:1500}):this._cloud.application||my&&my.showToast({type:"警告",content:"云应用加载失败",duration:1500});}_init(){let e=this;"function"==typeof window.PlatformAPI&&(window.PlatformAPI.request=function(t){let{url:i,method:s,header:r,data:n,onSuccess:a,onFailed:o,success:d,fail:h}=t,l=0,c=0;for(;c<i.length&&("/"!=i[c]||(l++,3!=l));c++);let u=i.substring(0,c),m=i.substring(c+1);return"string"==typeof n&&"{"==n[0]&&"}"==n[n.length-1]&&(n=JSON.parse(n)),new Promise(()=>{"POST"==s?e._httpRequestByTD(u,m,s,n,r).then(e=>{0==e.code?(console.log(e.data),d&&d(e.data),a&&a(e.data)):(h&&h(e.data),o&&o(e.data));}):e._httpRequestByTD(u,m,s,void 0,r).then(e=>{0==e.code?(d&&d(e.data),a&&a(e.data)):(h&&h(e.data),o&&o(e.data));});});});}_httpRequestByTD(e,t,r,n){return i(this,arguments,void 0,function*(e,t,i,r,n="application/json"){let a,o={path:"/"+t,method:i,headers:n,exts:{cloudAppId:s.tb_cloudAppId,timeout:4e3,domain:e},params:{},body:{}};"GET"==i&&""!=r?o.params=r:o.body=r;try{return a=yield this._cloud.application.httpRequest(o),{code:0,data:a};}catch(e){return{code:e.code,msg:e.msg};}});}_httpRequest(e,t,r,n){return i(this,arguments,void 0,function*(e,t,r,n,a="json"){return new Promise(a=>i(this,void 0,void 0,function*(){this._startCb&&this._startCb();let i,o={path:"/"+t,method:r,headers:{},exts:{cloudAppId:s.tb_cloudAppId,timeout:4e3,domain:e},params:{},body:{}};(n=Object.assign(Object.assign({},n),{ver:s.version,gameid:s.game_id,sign_type:"md5",time_stamp:Math.floor(Date.now()/1e3)+""}))&&n.code&&delete n.code,n.sign=h.createSign(n),"GET"==r&&""!=n?o.params=n:(o.body=n,o.headers="application/json");try{i=yield this._cloud.application.httpRequest(o),"string"==typeof i&&(i=JSON.parse(i)),t.indexOf(".json")>-1?(this._endCb&&this._endCb(),a({code:0,data:i,msg:i.msg,servertime:i.servertime})):(this._endCb&&this._endCb(),a({code:+i.code,data:i.data,msg:i.msg,servertime:i.servertime}));}catch(e){this._endCb&&this._endCb(),a({code:e.code,msg:e.msg});}}));});}get(e,t,s){return i(this,void 0,void 0,function*(){return yield this._httpRequest(e,t,"GET",s);});}post(e,t,s){return i(this,void 0,void 0,function*(){return yield this._httpRequest(e,t,"POST",s);});}}class E extends _{_buildParams(){let e=te.DataService.queryChannelId,t=te.Platform.getSystemInfoSync();return{channel:e,brand:t.brand,model:t.model,version:t.version,system:t.system,platform:t.platform,sdkversion:t.SDKVersion,scene:te.DataService.scene};}}class C extends p{tryPay(e,t){return i(this,void 0,void 0,function*(){if(0==te.Login.isLogin)return Promise.resolve({code:-1,msg:"未登录"});let i=yield this.createOrder(e,t);if(te.__LOG__&&console.log("创建订单:",i),0==i.code){let t={config:{money:i.data.price,itemId:i.data.taobao.itemId,outOrderId:i.data.taobao.outOrderId},paytype:i.data.pay_type.toString()},s=yield this._payInPlatform(t,e,i.data.no);return te.__LOG__&&console.log("支付结果:",s),null==s.data&&(s.data={}),s.data.order_id=i.data.no,s;}return i;});}retryPay(e,t){return i(this,void 0,void 0,function*(){return Promise.resolve({code:-1,msg:"淘宝平台暂不支持"});});}queryOrder(e){return 0==te.Login.isLogin?Promise.resolve({code:-1,msg:"未登录"}):g.queryOrder({uid:te.DataService.uid,token:te.DataService.token,no:e});}confirmOrder(e){return 0==te.Login.isLogin?Promise.resolve({code:-1,msg:"未登录"}):g.confirmOrder({uid:te.DataService.uid,token:te.DataService.token,no:e});}_payFromWallet(e,t,i){return te.Platform.requestPayment(e);}_buildParams(){let e=s.game_id,t=te.Platform.getSystemInfoSync(),i=t.brand,r=t.model,n=t.version,a=t.system,o=t.platform,d=t.SDKVersion,h=te.DataService.channelId;return{gameid:e,openid:te.DataService.openid,channel:h,brand:i,model:r,version:n,system:a,sdkversion:d,scene:te.DataService.scene+"",uid:te.DataService.uid,token:te.DataService.token,env:1===te.DataService.envEnum?"pre":"prod",platform:o};}}class O extends I{_getSystemInfoInPlatform(){let e=my.getSystemInfoSync(),t=my.getAppBaseInfoSync();return e.SDKVersion=e.version,delete e.version,e.version=t.version,e;}getLaunchOptionsSync(){const e=my.tb.getInteractiveSDK();let t=e.getShareInfo();return t.querys&&(t.query=t.querys,t.querys=void 0),t.scene=e.getChannelTag(),t;}_getWindowInfoInPlatform(){return my.getWindowInfoSync();}getUserInfo(){return new Promise(e=>{my.getAuthUserInfo({success:t=>{e(t?{code:0,data:t,msg:"success"}:{code:-1,msg:"获得用户信息失败"});},fail:t=>{e({code:-1,msg:"获得用户信息失败"});}});});}login(e){return e?new Promise(e=>{my.authorize({scopes:"scope.userInfo",success:t=>{e({code:0,data:{authCode:"taobao"},msg:"success"});},fail:t=>{e({code:t.error,msg:t.errorMessage});}});}):Promise.resolve({code:0,data:{authCode:"taobao"},msg:"success"});}onShareAppMessage(e){return new Promise(t=>{my.onShareAppMessage=function(){return Object.assign(Object.assign({},e),{success:e=>{t({code:0,msg:"成功",data:e});},fail:e=>{t({code:e.error,msg:e.errorMessage});}});};});}shareAppMessage(e){return new Promise(t=>{my.tb.getInteractiveSDK().shareApp({desc:e.title,thumbImgUrl:e.imageUrl}).catch(e=>{e.success?t({code:0,msg:"成功",data:e}):t({code:e.code?e.code:-1,msg:"失败"});}).then(e=>{e.success?t({code:0,msg:"成功",data:e}):t({code:e.code?e.code:-1,msg:"失败"});}),t({code:0,msg:"成功"});});}requestPayment(e){return new Promise(t=>{my.tb.virtualTrade({itemId:e.itemId,outOrderId:e.outOrderId,success:e=>{"9000"==e.resultCode?t({code:0,msg:"支付宝成功"}):t({code:Number(e.resultCode),msg:e.memo});},fail:e=>{console.log(e),t({code:Number(e.error),msg:e.errorDescription});}});});}createRewardedVideoAd(e){return this._env.createRewardedAd(e);}reportScene(e){const t=my.tb.getInteractiveSDK();t&&t.reportScene&&t.reportScene({sceneId:e,timestamp:Date.now(),costTime:2e3});}navigateLimitUrl(e){const t=my.tb.getInteractiveSDK();t&&t.navigateLimitUrl&&t.navigateLimitUrl({url:e}).catch(e=>{console.log(e);});}}t([y("getAuthUserInfo")],O.prototype,"getUserInfo",null),t([y("authorize")],O.prototype,"login",null),t([y("onShareAppMessage")],O.prototype,"onShareAppMessage",null),t([y("tb.getInteractiveSDK")],O.prototype,"shareAppMessage",null),t([y("tb.virtualTrade")],O.prototype,"requestPayment",null),t([y("createRewardedAd")],O.prototype,"createRewardedVideoAd",null);class k extends A{constructor(){super(...arguments),this._isPlaying=!1,this._isErrored=!1,this.videoKey="",this.adUnitId="",this.show_time=0,this.isPreload=!1,this.preError=e=>{null!=this.videoAd2&&(this.videoAd2.offError(this.preError),this.videoAd2=null,this.isPreload=!1,te.__LOG__&&console.warn("视频预加载失败"));},this.handleLoaded01=()=>{this.videoAd2.offError(this.preError),this.preloadVideoAd=this.videoAd2,this.isPreload=!1,te.__LOG__&&console.warn("视频预加载成功");},this.offPreload=()=>{this.preloadVideoAd=null;},this.onError=e=>{!this.isErrored&&this.handleError(e);},this.handleClose=e=>{let t=e&&e.isCompleted||void 0===e;te.__LOG__&&console.warn(t?"激励视频播放成功":"激励视频播放失败");let i=Math.floor((Date.now()-this.show_time)/1e3);t?(te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Complete,i),this.resolve&&this.resolve({code:0,data:{time:i}})):(te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Interrupt,i),this.reject&&this.reject(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoQuit),{data:{time:i}}))),this.videoAd.offClose(this.handleClose),this.videoAd.offError(this.onError),this.videoAd=null,this.preloadVideo(this.adUnitId),this._isPlaying=!1,this._isErrored=!1;};}get isErrored(){return this._isErrored;}get isPlaying(){return this._isPlaying;}preloadVideo(e=s.videoAd){this.preloadVideoAd||this.isPreload||(this.isPreload=!0,this.videoAd2=te.Platform.createRewardedVideoAd({adUnitId:e}),setTimeout(()=>{this.videoAd2&&(this.videoAd2.onError(this.preError),this.videoAd2.load().then(this.handleLoaded01).catch(()=>{this.isPreload=!1;}));},300));}show(e){return i(this,arguments,void 0,function*(e,t=s.videoAd){return new Promise((s,r)=>i(this,void 0,void 0,function*(){if(this.isPlaying)return r(Object.assign({},te.EnumConst.ShareVideoError.VideoPlaying));if(!t)return r(Object.assign({},te.EnumConst.ShareVideoError.VideoInvalid));let i,n;if(this.preloadVideoAd)te.__LOG__&&console.log("使用预加载视频"),n=!0,i=this.preloadVideoAd,this.offPreload();else{te.__LOG__&&console.log("不使用预加载视频"),n=!1;try{i=te.Platform.createRewardedVideoAd({adUnitId:t});}catch(e){te.__LOG__&&console.log("不使用预加载视频23:",JSON.stringify(e));}}if(!i)return r(Object.assign({},te.EnumConst.ShareVideoError.VideoNotOpen));if(te.Analytics.adStat(e,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Request),this._isPlaying=!0,this._isErrored=!1,this.videoKey=e,this.adUnitId=t,this.resolve=s,this.reject=r,this.videoAd=i,i.onClose(this.handleClose),i.onError(this.onError),n)try{yield this.handleLoaded02();}catch(e){te.__LOG__&&console.log("error",e),yield i.load(),this.handleLoaded02();}else try{yield new Promise(e=>{setTimeout(()=>{e(null);},300);}),yield i.load(),yield this.handleLoaded02();}catch(e){this.handleError({});}te.__LOG__&&console.warn("激励视频请求adUnitId",t);}));});}handleLoaded02(){return i(this,void 0,void 0,function*(){try{te.__LOG__&&console.warn("尝试播放激励视频"),te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Show),this.show_time=Date.now(),yield this.videoAd.show();}catch(e){te.__LOG__&&console.log("激励视频加载失败",e),this.handleError({});}});}handleError(e){te.__LOG__&&console.warn("激励视频加载失败",e),te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Fail),this.reject&&(this.videoAd?this.reject(Object.assign({},te.EnumConst.ShareVideoError.VideoFail)):this.reject(Object.assign({},te.EnumConst.ShareVideoError.VideoWatchMax))),this._isPlaying=!1,this._isErrored=!0;}}class L extends m{constructor(){super(),this.interstitialAdId=s.interstitialAdId,this.interstitialSuccell=!1,this._canUsed=te.Platform.isSupport("createInterstitialAd");}init(e=s.interstitialAdId){if(0==this._canUsed)return super.init(e);""!=e&&(this.interstitialAdId=e,this._createInterstitial());}show(e=s.interstitialAdId){return 0==this._canUsed?super.show(e):""!=e?new Promise((t,s)=>i(this,void 0,void 0,function*(){this.interstitialAdId=e,this.interstitialSuccell?this.interstitialAd.show().then(e=>{t&&t({code:0,msg:"展示成功！"}),te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Complete);}).catch(e=>{te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Interrupt),t&&t({code:e.errCode,msg:e.errMsg});}):this._createInterstitial(!0,t);})):void 0;}_createInterstitial(e=!1,t){te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Request),this.interstitialAd=te.Platform.createInterstitialAd({adUnitId:this.interstitialAdId}),this.interstitialAd.onLoad(()=>i(this,void 0,void 0,function*(){this.interstitialSuccell=!0,e&&this.interstitialAd.show().then(e=>{t&&t({code:0,msg:"展示成功！"}),te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Complete);}).catch(e=>{this.interstitialSuccell=!1,te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Interrupt),t&&t({code:e.errCode,msg:e.errMsg});});})),this.interstitialAd.onError(e=>{te.Analytics.adStat("InterstitialAd",this.interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Fail),this.interstitialSuccell=!1,t&&t({code:e.errCode,msg:e.errMsg});}),this.interstitialAd.onClose(e=>{this._createInterstitial(!1);});}}class U extends p{tryPay(e,t){return i(this,void 0,void 0,function*(){if(0==te.Login.isLogin)return Promise.resolve({code:-1,msg:"未登录"});let i=yield this.createOrder(e,t);if(te.__LOG__&&console.log("创建订单:",i),0==i.code){let t={paytype:i.data.pay_type.toString(),pay_request_data:i.data.pay_request_data},s=yield this._payInPlatform(t,e,i.data.no);return te.__LOG__&&console.log("支付结果:",s),null==s.data&&(s.data={}),s.data.order_id=i.data.no,s;}return i;});}_payFromWallet(e,t,i){return te.Platform.requestPayment(e);}}var M,j;!function(e){let t,i=0,s=!1;function r(){s=!1,i=0,te.Platform.offShow(a),te.Platform.offHide(n);}e.bind=function(e){let{success:o,fail:d}=e,h=!0;e.success=e=>{h&&o(e),h=!1;},e.fail=e=>{h&&d(e),h=!1;},t=e,s&&r(),s=!0,i=0,te.Platform.onShow(a),te.Platform.onHide(n);};let n=()=>{i=new Date().getTime();},a=()=>{let e,{success:s,fail:n}=t,a=Date.now();e=a-i<3e3?setTimeout(()=>{te.__LOG__&&console.warn("SDK SimulateShare 模拟分享失败！"),n&&n({code:-1,msg:"模拟分享失败！"}),clearTimeout(e),e=null;},300):setTimeout(()=>{te.__LOG__&&console.warn("SDK SimulateShare 模拟分享成功！"),s&&s({code:0,msg:"模拟分享成功！",data:{shareTickets:["simulate_ticket"]}}),clearTimeout(e),e=null;},300),r();};}(M||(M={}));class G extends v{constructor(){super(...arguments),this._env=wx,this._vibrateShortFlag=!1;}vibrateShort(e="light"){0!=this.shake&&(this._vibrateShortFlag||(this._vibrateShortFlag=!0,this._env.vibrateShort({type:e}),setTimeout(()=>{this._vibrateShortFlag=!1;},100)));}vibrateLong(){0!=this.shake&&this._env.vibrateLong();}restartGame(){this._env.restartMiniProgram();}exitGame(){this._env.exitMiniProgram();}showToast(e,t="none",i=1500){this._env.showToast({title:e,icon:t,duration:i});}showModal(e){return new Promise(t=>{this._env.showModal(Object.assign(Object.assign({},e),{success:e=>{1==e.confirm?t&&t({code:0,data:e.content,msg:"success"}):t&&t({code:-1,msg:e.cancel?"取消":e.errMsg});},fail:e=>{t&&t({code:-1,msg:e.errMsg});}}));});}_getSystemInfoInPlatform(){return this._env.getSystemInfoSync();}getLaunchOptionsSync(){return this._env.getLaunchOptionsSync();}getEnterOptionsSync(){return this._env.getEnterOptionsSync();}_getWindowInfoInPlatform(){return this._env.getWindowInfo();}createGameClubButton(e){return this._dealBtnStyle(e.style),this._env.createGameClubButton(e);}requestSubscribeMessage(e){return new Promise(t=>{this._env.requestSubscribeMessage({tmplIds:e,success:i=>{i=i||{};let s=e.filter(e=>i[e]&&"accept"===i[e]);s.length?(console.log("订阅成功",i,s),t({code:0,data:s})):(console.log("未订阅"),t({code:-1,msg:"未订阅"}));},fail:e=>{console.log("取消订阅"),t(this._formatMsg(e));}});});}requestSubscribeSystemMessage(e){return new Promise(t=>{this._env.requestSubscribeSystemMessage({templateId:e,success:i=>{i=i||{};let s=e.filter(e=>i[e]&&"accept"===i[e]);s.length?(console.log("订阅成功",i,s),t({code:0,data:s})):(console.log("未订阅"),t({code:-1,msg:"未订阅"}));},fail:e=>{t(this._formatMsg(e));}});});}getUserInfo(){return new Promise(e=>{this._env.getUserInfo({lang:"zh_CN",withCredentials:!0,success:t=>{t?(te.DataService.updateData({authorize:!0}),e({code:0,data:t,msg:"成功"})):(te.DataService.updateData({authorize:!1}),e({code:-1,msg:"获得用户信息失败"}));},fail:t=>{t.errNo?(te.DataService.updateData({authorize:!1}),e({code:-1,msg:"获得用户信息失败"})):(te.DataService.updateData({authorize:!0}),e({code:0,data:t,msg:"成功"}));}});});}login(){return new Promise(e=>{this._env.login({success:t=>{e({code:0,data:{authCode:t.code}});},fail:t=>{e({code:t.errno,msg:t.errMsg});}});});}createUserInfoButton(e){return this._dealBtnStyle(e.style),this._env.createUserInfoButton(e);}getSetting(e=!0){return new Promise(t=>{this._env.getSetting({withSubscriptions:e,success:e=>{var i;(null===(i=e.authSetting)||void 0===i?void 0:i["scope.userInfo"])&&te.DataService.updateData({authorize:!0}),e.subscriptionsSetting&&(e.subscriptionsSetting=this._formatSubscribeMsg(e.subscriptionsSetting)),t({code:0,data:e});},fail:e=>{console.log("获得设置失败"),t({code:-1,msg:"获得getting 失败"});}});});}setMessageToFriendQuery(e,t){return{code:0,data:this._env.setMessageToFriendQuery({shareMessageToFriendScene:e,query:t})};}onShareAppMessage(e){return new Promise(t=>{this._env.onShareAppMessage(function(){return M.bind({success:e=>{te.__LOG__&&console.error("右上角分享成功"),t&&t({code:0,data:e.errMsg});},fail:e=>{te.__LOG__&&console.error("右上角分享失败"),t&&t({code:-1,msg:e.errMsg});},cancel:e=>{te.__LOG__&&console.error("右上角分享取消"),t&&t({code:-1,msg:e.errMsg});}}),e;}),this.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]});});}updateShareMenu(e){this._env.updateShareMenu(e);}showShareMenu(e){this._env.showShareMenu(e);}shareAppMessage(e){return new Promise(t=>{let i={success:e=>{te.__LOG__&&console.error("微信分享成功"),t(e);},fail:e=>{te.__LOG__&&console.error("微信分享失败"),t(Object.assign({},te.EnumConst.ShareVideoError.ShareNotGroup));},cancel:()=>{te.__LOG__&&console.error("微信分享取消",null),t(null);}};M.bind(i),this._env.shareAppMessage(e);});}navigateToMiniProgram(e){return new Promise(t=>{this._env.navigateToMiniProgram({appId:e.appId,path:e.path,extraData:e.extraData,envVersion:e.envVersion||"release",shortLink:e.shortLink,noRelaunchIfPathUnchanged:e.noRelaunchIfPathUnchanged,success:e=>{t({code:0,data:e,msg:"success"});},fail:e=>{t(this._formatMsg(e));}});});}onShow(e){this._env.onShow(e);}onHide(e){this._env.onHide(e);}offShow(e){this._env.offShow(e);}offHide(e){this._env.offHide(e);}getNetworkType(){return new Promise(e=>{this._env.getNetworkType({success(t){e(t);},fail(t){e({networkType:l.NetworkType.Unknown,isConnected:!0});}});});}onNetworkStatusChange(e){this._env.onNetworkStatusChange(t=>{e&&e({isConnected:t.isConnected,networkType:t.networkType.toLowerCase()});});}openCustomerServiceConversation(e){return new Promise(t=>{this._env.openCustomerServiceConversation({showMessageCard:e.showMessageCard,sendMessageTitle:e.sendMessageTitle,sendMessagePath:e.sendMessagePath,sendMessageImg:e.sendMessageImg,success:e=>{t({code:0,data:e,msg:"success"});},fail:e=>{t({code:-1,msg:e.errMsg});}});});}previewImage(e){return new Promise(t=>{this._env.previewImage({current:e.current,urls:e.urls,showmenu:e.showmenu,referrerPolicy:e.referrerPolicy,success:e=>{t({code:0,data:e,msg:"success"});},fail:e=>{t({code:-1,msg:e.errMsg});}});});}requestPayment(e){let{mode:t,env:i,offerId:s,currencyType:r,platform:n,buyQuantity:a,zoneId:o}=e;return console.warn("====>支付参数",{mode:t,env:i,offerId:s,currencyType:r,platform:n,buyQuantity:a,zoneId:o}),new Promise(e=>{this._env.requestMidasPayment({mode:t,env:i,offerId:s,currencyType:r,platform:n,buyQuantity:a,zoneId:o,success:t=>{t&&"requestMidasPayment:ok"===t.errMsg?e({code:0,data:t,msg:"success"}):e(this._formatMsg(t));},fail:t=>{e(this._formatMsg(t));}});});}createInterstitialAd(e){return this._env.createInterstitialAd(e);}createRewardedVideoAd(e){return this._env.createRewardedVideoAd(e);}createGameBanner(e){return this._env.createGameBanner(e);}createCustomAd(e){return this._env.createCustomAd(e);}getShareInfo(e){return new Promise(t=>{this._env.getShareInfo({shareTicket:e,success:e=>{"getShareInfo:ok"==e.errMsg?t({code:0,msg:"success",data:e}):t({code:-1,msg:"fail",data:e});},fail:e=>{t({code:-1,msg:"fail",data:e});}});});}createFeedbackButton(e){return this._dealBtnStyle(e.style),this._env.createFeedbackButton(e);}checkUpdate(e){return new Promise(t=>{let s=this._env.getUpdateManager();s.onCheckForUpdate(e=>{e.hasUpdate||t({code:-1,msg:"没有升级"});}),s.onUpdateReady(r=>i(this,void 0,void 0,function*(){0==(yield this.showModal(e)).code&&(t({code:0,msg:"启动升级"}),s.applyUpdate());})),s.onUpdateFailed(e=>{t({code:-1,msg:"升级失败"});});});}setClipboardData(e){return new Promise(t=>{this._env.setClipboardData({data:e,success:e=>{t({code:0,msg:"success"});},fail:e=>{t({code:-1,msg:"fail"});}});});}getClipboardData(){return new Promise(e=>{this._env.getClipboardData({success:t=>{e({code:0,msg:t.data});},fail:t=>{e({code:-1,msg:"fail"});}});});}postMessageToOpenDataContext(e){return this._env.getOpenDataContext().postMessage(e),Promise.resolve({code:0,msg:"开放域数据修改成功"});}setUserCloudStorage(e){return new Promise(t=>{this._env.setUserCloudStorage({KVDataList:e,success:e=>{"setUserCloudStorage:ok"==e.errMsg?t({code:0,msg:"success"}):t(this._formatMsg(e));},fail:e=>{t(this._formatMsg(e));}});});}checkIsAddedToMyMiniProgram(){return new Promise(e=>{this._env.checkIsAddedToMyMiniProgram({success:t=>{t.added?e({code:0,msg:"success"}):e({code:-1,msg:"fail"});},fail:t=>{e({code:-1,msg:"fail"});}});});}onMemoryWarning(e){this._env.onMemoryWarning(e);}offMemoryWarning(e){this._env.offMemoryWarning(e);}triggerGC(){this._env.triggerGC();}getGameClubData(e){return new Promise(t=>{this._env.getGameClubData(Object.assign(Object.assign({},e),{success:e=>{e.data&&e.data.errCode?t({code:-1,data:e}):t({code:0,data:e,msg:"success"});},fail:e=>{t(this._formatMsg(e));}}));});}showLoading(e,t=!1){return new Promise(i=>{this._env.showLoading({title:e,mask:t||!0,success:e=>{i({code:0,msg:"success"});},fail:e=>{i({code:-1,msg:e.errMsg});}});});}hideLoading(){return new Promise(e=>{this._env.hideLoading({success:t=>{e({code:0,msg:"success"});},fail:t=>{e(this._formatMsg(t));}});});}uploadFile(e){return new Promise(t=>{this._env.uploadFile(Object.assign(Object.assign({},e),{success:e=>{t({code:0,data:e,msg:"success"});},fail:e=>{t(this._formatMsg(e));}}));});}chooseImage(e){return this.chooseMedia({count:e.count,mediaType:["image"],sourceType:["album","camera"],sizeType:["compressed"],camera:"back"});}chooseMedia(e){return new Promise(t=>{this._env.chooseMedia(Object.assign(Object.assign({},e),{success:e=>{t({code:0,data:e,msg:"success"});},fail:e=>{t(this._formatMsg(e));}}));});}}t([y()],G.prototype,"vibrateShort",null),t([y()],G.prototype,"vibrateLong",null),t([y("restartMiniProgram","重启游戏 不支持")],G.prototype,"restartGame",null),t([y("exitMiniProgram","退出游戏 不支持")],G.prototype,"exitGame",null),t([y()],G.prototype,"showToast",null),t([y()],G.prototype,"showModal",null),t([y("getSystemInfoSync")],G.prototype,"_getSystemInfoInPlatform",null),t([y()],G.prototype,"getLaunchOptionsSync",null),t([y()],G.prototype,"getEnterOptionsSync",null),t([y("getWindowInfo")],G.prototype,"_getWindowInfoInPlatform",null),t([y()],G.prototype,"createGameClubButton",null),t([y()],G.prototype,"requestSubscribeMessage",null),t([y()],G.prototype,"requestSubscribeSystemMessage",null),t([y("getUserInfo")],G.prototype,"getUserInfo",null),t([y("login")],G.prototype,"login",null),t([y()],G.prototype,"createUserInfoButton",null),t([y()],G.prototype,"getSetting",null),t([y()],G.prototype,"setMessageToFriendQuery",null),t([y()],G.prototype,"onShareAppMessage",null),t([y()],G.prototype,"updateShareMenu",null),t([y()],G.prototype,"showShareMenu",null),t([y()],G.prototype,"shareAppMessage",null),t([y()],G.prototype,"navigateToMiniProgram",null),t([y()],G.prototype,"onShow",null),t([y()],G.prototype,"onHide",null),t([y()],G.prototype,"offShow",null),t([y()],G.prototype,"offHide",null),t([y()],G.prototype,"getNetworkType",null),t([y()],G.prototype,"onNetworkStatusChange",null),t([y()],G.prototype,"openCustomerServiceConversation",null),t([y()],G.prototype,"previewImage",null),t([y("requestMidasPayment")],G.prototype,"requestPayment",null),t([y()],G.prototype,"createInterstitialAd",null),t([y()],G.prototype,"createRewardedVideoAd",null),t([y()],G.prototype,"createGameBanner",null),t([y()],G.prototype,"createCustomAd",null),t([y()],G.prototype,"getShareInfo",null),t([y()],G.prototype,"createFeedbackButton",null),t([y("getUpdateManager")],G.prototype,"checkUpdate",null),t([y("setClipboardData","setClipboardData 不支持")],G.prototype,"setClipboardData",null),t([y()],G.prototype,"getClipboardData",null),t([y()],G.prototype,"postMessageToOpenDataContext",null),t([y()],G.prototype,"setUserCloudStorage",null),t([y()],G.prototype,"checkIsAddedToMyMiniProgram",null),t([y()],G.prototype,"onMemoryWarning",null),t([y()],G.prototype,"offMemoryWarning",null),t([y()],G.prototype,"triggerGC",null),t([y("getGameClubData")],G.prototype,"getGameClubData",null),t([y()],G.prototype,"showLoading",null),t([y()],G.prototype,"hideLoading",null),t([y()],G.prototype,"uploadFile",null),t([y()],G.prototype,"chooseMedia",null);class V extends G{constructor(){super(...arguments),this._env=tt;}requestPayment(e){return i(this,void 0,void 0,function*(){let t=yield this.checkSession();if(t.code)return t;{let t=this.getSystemInfoSync().platform;if("android"==t){return 0==this.isSupport("requestGamePayment")?Promise.resolve({code:-1,msg:"当前平台不支持支付"}):new Promise(t=>{this._env.requestGamePayment(Object.assign(Object.assign({},e),{success:function(e){t({code:0,msg:"支付成功",data:e});},fail:function(e){t({code:-1,msg:"支付失败",data:e});}}));});}if("ios"==t){return 0==this.isSupport("openAwemeCustomerService")?Promise.resolve({code:-1,msg:"当前平台不支持支付"}):new Promise(t=>{this._env.openAwemeCustomerService(Object.assign(Object.assign({},e),{success:function(e){t({code:0,msg:"支付成功",data:e});},fail:function(e){t({code:-1,msg:"支付失败",data:e});}}));});}return Promise.resolve({code:-1,msg:"平台不支持"});}});}checkSession(){return new Promise(e=>{this._env.checkSession({success:function(){e({code:0,msg:"session_key 未过期"});},fail:function(){e({code:-1,msg:"session_key 已经过期"});}});});}shareAppMessage(e){return new Promise(t=>{e.success=e=>{console.log(e),t({code:0,msg:"分享成功",data:e.data});},e.fail=e=>{t(this._formatMsg(e));},this._env.shareAppMessage(e);});}restartGame(){this._env.restartMiniProgramSync();}chooseImage(e){return new Promise(t=>{this._env.chooseImage({count:e.count,sourceType:["album","camera"],success:e=>{t({code:0,data:e,msg:"success"});},fail:e=>{t(this._formatMsg(e));}});});}}t([y()],V.prototype,"shareAppMessage",null),t([y("restartMiniProgramSync","重启游戏 不支持")],V.prototype,"restartGame",null),t([y()],V.prototype,"chooseImage",null);class x extends A{constructor(){super(),this._isPlaying=!1,this._canUsed=te.Platform.isSupport("createRewardedVideoAd");}show(e,t){const r=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){return 0==this._canUsed?r.show.call(this,e,t):(""==t&&(t=s.videoAd),new Promise((s,r)=>i(this,void 0,void 0,function*(){if(this._isPlaying)return r(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoPlaying),{data:{time:0}}));if(!t)return r(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoInvalid),{data:{time:0}}));let i=te.Platform.createRewardedVideoAd({adUnitId:t});if(null==i)return r(Object.assign({},te.EnumConst.ShareVideoError.VideoNotOpen));this._isPlaying=!0,te.Analytics.adStat(e,t,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Request);let n=Date.now(),a=()=>{this._isPlaying=!1,null!=i&&(i.offClose(h),i.offError(o),i.destroy(),i=null);},o=i=>{te.Analytics.adStat(e,t,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Fail),r({code:i.errCode,msg:i.errMsg,data:{time:0}}),a();},d=Math.floor((Date.now()-n)/1e3),h=i=>{i&&i.isEnded?(te.Analytics.adStat(e,t,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Complete,d),s({code:0,data:{time:d}})):(te.Analytics.adStat(e,t,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Interrupt,d),r(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoQuit),{data:{time:d}}))),a();};i.onClose(h),i.onError(o),i.load().then(()=>{i.show();});})));});}}class R extends a{constructor(){super(),this.queue=[],this.isEnd=!1,this.onLoad=()=>{this.bannerAd&&(te.__LOG__&&console.warn("Banner onLoad: "+this.adUnitId),this._unbind(),this.handleQueue(),this.resolve&&this.resolve({adUnitId:this.adUnitId,scale:this.bannerScale}));},this.onError=e=>{te.__LOG__&&console.warn("Banner onError",e),!this._isErrored&&this._handleError(e,Object.assign(Object.assign({},te.EnumConst.BannerError.BannerFail),{adUnitId:this.adUnitId}));},this.onResize=()=>{this.bannerAd;},this._canUsed=te.Platform.isSupport("createCustomAd");}init(e=750,t=750){if(0==this._canUsed)return super.init(e,t);this.adUnitId="",this._isErrored=!1,this.designWidth=e;let i=te.Platform.getSystemInfoSync();this.bannerScale=i.windowWidth/this.designWidth,this.bannerWidth=Math.max(this.bannerScale*t,300),this.bannerHeight=i.windowHeight/this.bannerScale;}get isErrored(){return this._isErrored;}create(e=s.bannerId,t=!0,i){return 0==this._canUsed?super.create(e,t,i):""==e||null==e?(this.handleQueue(),this.reject(Object.assign(Object.assign({},te.EnumConst.BannerError.BannerInvalid),{adUnitId:this.adUnitId}))):(this.bannerParams=i||{},i&&i.bannerWidth&&(this.bannerWidth=i.bannerWidth),this.isEnd=!0,this.bannerParams.type=this.bannerParams.type||1,this.bannerParams.offsetY=-this.bannerParams.offsetY||0,this.bannerParams.adIntervals=this.bannerParams.adIntervals||120,new Promise((i,s)=>{if(this.resolve=i,this.reject=s,this._isErrored=!1,this.adUnitId=e,this.bannerAd)return void(t&&this.show(!1));let r=this.bannerWidth||te.Platform.getSystemInfoSync().windowWidth;r=Math.min(r,te.Platform.getSystemInfoSync().windowWidth);let n=r/375*130,a={top:te.Platform.getSystemInfoSync().windowHeight-n+this.bannerParams.offsetY,left:(te.Platform.getSystemInfoSync().windowWidth-this.bannerWidth)/2,width:this.bannerWidth};if(this.bannerAd=te.Platform.createCustomAd({adUnitId:e,style:a}),te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Request),!this.bannerAd)return this.handleQueue(),this.reject(Object.assign(Object.assign({},te.EnumConst.BannerError.BannerNotOpen),{adUnitId:this.adUnitId}));this.bannerAd.onLoad(this.onLoad),this.bannerAd.onError(this.onError),this.bannerAd.onResize(this.onResize),t&&this.show(!1);}));}show(e=!0){return 0==this._canUsed?super.show(e):this.isEnd&&e?void this.queue.push(this.show.bind(this)):(this.isEnd=!0,this.bannerAd?(te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Show),this.bannerAd.show().catch(e=>this._handleShowError(e)),te.__LOG__&&console.warn("Banner show: "+this.adUnitId,this.bannerAd.style),this.handleQueue(),!0):(this.handleQueue(),!1));}hide(){if(0==this._canUsed)return super.hide();this.isEnd?this.queue.push(this.hide.bind(this)):(this.isEnd=!0,this.bannerAd&&(this.bannerAd.hide(),te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Interrupt),te.__LOG__&&console.warn("Banner hide: "+this.adUnitId)),this.handleQueue());}destory(){if(0==this._canUsed)return super.destory();this.bannerAd&&(this.bannerAd.style.left=-9999,this.bannerAd.destroy(),this.bannerAd=null,te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Interrupt),te.__LOG__&&console.warn("Banner destory: "+this.adUnitId));}_handleShowError(e){te.__LOG__&&console.warn("Banner handleShowError",e);let{errCode:t,errMsg:i}=e;!this.isErrored&&this._handleError(e,{code:t,msg:i});}_handleError(e,t){var i;this._unbind(),this._isErrored=!0,null===(i=this.bannerAd)||void 0===i||i.destroy(),this.bannerAd=null,this.handleQueue(),te.Analytics.adStat("banner",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Banner,te.EnumConst.DOT_AD_STATUS.Fail),this.reject&&this.reject(Object.assign(Object.assign({},t),{adUnitId:this.adUnitId})),te.__LOG__&&console.warn("Banner onError: "+this.adUnitId);}_unbind(){this.bannerAd;}handleQueue(){if(this.queue.length>0){this.isEnd=!1,this.queue.shift()();}else this.isEnd=!1;}}class H extends o{constructor(){super(),this.queue=[],this.isEnd=!1,this.onShowError=e=>{te.__LOG__&&console.error("WxCustom - handleShowError",e);let{errCode:t,errMsg:i}=e;!this.isErrored&&this.handleError(e,{code:t,msg:i});},this._onLoad=()=>{this.customAd&&(this.show(!1),te.__LOG__&&console.error("WxCustom - onLoad: "+this.adUnitId),this.unbind(),this.resolve&&this.resolve({adUnitId:this.adUnitId,top:this.bannerParams.top,left:this.bannerParams.left}));},this.onError=e=>{te.__LOG__&&console.error("WxCustom - onError",e),!this._isErrored&&this.handleError(e,Object.assign(Object.assign({},te.EnumConst.BannerError.BannerFail),{adUnitId:this.adUnitId}));},this.onClose=()=>{this.customAd=null,te.Analytics.dot("wxCustom_close");},this.adUnitId="",this._isErrored=!1,this._canUsed=te.Platform.isSupport("createCustomAd");}get isErrored(){return this._isErrored;}create(e=s.customId,t){return 0==this._canUsed?super.create(e,t):(this.bannerParams=t||{},this.bannerParams.adIntervals=this.bannerParams.adIntervals||60,this.customAd&&this.isEnd?void this.queue.push(this.show):(this.isEnd=!0,new Promise((i,s)=>{if(this.resolve=i,this.reject=s,this._isErrored=!1,this.adUnitId=e,""==e||null==e)return this.handleQueue(),this.reject(Object.assign(Object.assign({},te.EnumConst.BannerError.BannerInvalid),{adUnitId:this.adUnitId}));if(this.customAd)return void this.show(!1);let r={top:t.top,left:t.left};if(this.customAd=te.Platform.createCustomAd({adUnitId:e,style:r,adIntervals:this.bannerParams.adIntervals}),te.Analytics.adStat("custom",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Custom,te.EnumConst.DOT_AD_STATUS.Request),!this.customAd)return this.reject(Object.assign(Object.assign({},te.EnumConst.BannerError.BannerNotOpen),{adUnitId:this.adUnitId}));this.customAd.onLoad(this._onLoad),this.customAd.onClose(this.onClose),this.customAd.onError(this.onError);})));}show(e=!0){return 0==this._canUsed?super.show(e):this.isEnd&&e?void this.queue.push(this.show):(this.isEnd=!0,this.customAd?(te.Analytics.adStat("custom",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Custom,te.EnumConst.DOT_AD_STATUS.Show),this.customAd.show().then(e=>{this.handleQueue();}).catch(this.onShowError),te.__LOG__&&console.error("WxCustom - show: "+this.adUnitId,this.customAd),!0):(this.handleQueue(),!1));}hide(){if(0==this._canUsed)return super.hide();this.isEnd?this.queue.push(this.hide):(this.isEnd=!0,this.customAd&&(this.customAd.hide(),te.Analytics.adStat("custom",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Custom,te.EnumConst.DOT_AD_STATUS.Interrupt),te.__LOG__&&console.error("WxCustom - hide: "+this.adUnitId)),this.handleQueue());}destory(){if(0==this._canUsed)return super.destory();this.customAd&&(this.customAd.destroy(),this.customAd=null,te.Analytics.adStat("custom",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Custom,te.EnumConst.DOT_AD_STATUS.Interrupt),te.__LOG__&&console.error("WxCustom - destory: "+this.adUnitId));}handleError(e,t){this.unbind(),this._isErrored=!0,this.customAd&&this.customAd.destroy(),this.customAd=null,this.handleQueue(),this.reject&&this.reject(Object.assign(Object.assign({},t),{adUnitId:this.adUnitId})),te.Analytics.adStat("custom",this.adUnitId,te.EnumConst.DOT_AD_TYPE.Custom,te.EnumConst.DOT_AD_STATUS.Fail),te.__LOG__&&console.error("WxCustom - onError: "+this.adUnitId);}unbind(){this.customAd;}handleQueue(){if(this.queue.length>0){this.isEnd=!1,this.queue.shift().apply(this);}else this.isEnd=!1;}}class F extends m{constructor(){super(),this._interstitialSuccell=!1,this._canUsed=te.Platform.isSupport("createInterstitialAd");}init(e=s.interstitialAdId){if(0==this._canUsed)return super.init(e);""!=e&&(this._interstitialAdId=e,this._createInterstitial());}show(e=s.interstitialAdId){return 0==this._canUsed?super.show(e):""!=e?new Promise((t,s)=>i(this,void 0,void 0,function*(){this._interstitialAdId=e,this._interstitialSuccell?this._interstitialAd.show().then(e=>{t&&t({code:0,msg:"展示成功！"}),te.Analytics.adStat("InterstitialAd",this._interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Complete);}).catch(e=>{te.Analytics.adStat("InterstitialAd",this._interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Interrupt),t&&t({code:e.errCode,msg:e.errMsg});}):this._createInterstitial(!0,t);})):void 0;}_createInterstitial(e=!1,t){this._interstitialSuccell=!1,te.Analytics.adStat("InterstitialAd",this._interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Request),this._interstitialAd=te.Platform.createInterstitialAd({adUnitId:this._interstitialAdId}),this._interstitialAd.onLoad(()=>i(this,void 0,void 0,function*(){this._interstitialSuccell=!0,e&&this._interstitialAd.show().then(e=>{t&&t({code:0,msg:"展示成功！"}),te.Analytics.adStat("InterstitialAd",this._interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Complete);}).catch(e=>{this._interstitialSuccell=!1,te.Analytics.adStat("InterstitialAd",this._interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Interrupt),t&&t({code:e.errCode,msg:e.errMsg});});})),this._interstitialAd.onError(e=>{te.Analytics.adStat("InterstitialAd",this._interstitialAdId,te.EnumConst.DOT_AD_TYPE.Interstitial,te.EnumConst.DOT_AD_STATUS.Fail),this._interstitialSuccell=!1,t&&t({code:e.errCode,msg:e.errMsg}),console.log(e);}),this._interstitialAd.onClose(e=>{this._interstitialAd.destory(),this._createInterstitial(!1);});}}class q extends p{_payFromWallet(e,t,i){return new Promise(r=>{let{Mode:n,OfferId:a,ZoneId:o,CurrencyType:d,Platform:h}=s.MidasPay,l={mode:n,env:te.DataService.envEnum,platform:te.Platform.getSystemInfoSync().platform,offerId:a,currencyType:d,buyQuantity:e.money/10,zoneId:o,outTradeNo:i},c=Object.assign(Object.assign({},this._buildParams()),{midasenv:te.DataService.envEnum===te.EnumConst.VersionEnv.STAGE?0:1,orderid:i,payid:e.payid,goodid:t,type:0,money:e.money});this.payReport(c).then(e=>{0==e.code?te.Platform.requestPayment(l).then(e=>{0==e.code?this._handlePaySuccess(c,r):this._handlePayError(c,e.data,r);}):r(e);});});}_handlePaySuccess(e,t){return i(this,arguments,void 0,function*(e,t,i=1e3){e.type=1;var s=this;e.then(r=>{0==r.code?t(r):(i=Math.min(2*i,6e4),setTimeout(()=>{s._handlePaySuccess(e,t,i);},i));});});}_handlePayError(e,t,i,s=1e3){let r=2;t.errCode+""=="1"&&(r=3),e.type=r,this.payReport(e).then(r=>{0==r.code?i({code:t.errCode,msg:t.errMsg}):(s=Math.min(2*s,6e4),setTimeout(()=>{this._handlePayError(e,t,i,s);},s));});}}class N extends A{get isErrored(){return this._isErrored;}get isPlaying(){return this._isPlaying;}constructor(){super(),this._isPlaying=!1,this._isErrored=!1,this.videoKey="",this.adUnitId="",this.show_time=0,this.isPreload=!1,this.onErrorPre=()=>{null!=this.videoAd2&&(this.videoAd2.destory(),this.videoAd2=null,this.isPreload=!1,te.__LOG__&&console.warn("视频预加载失败"));},this.onError01=e=>{!this.isErrored&&this.handleError(e);},this.handleClose=e=>{te.__LOG__&&console.warn("====>激励视频关闭",e&&e.isEnded||void 0===e);let t=Math.floor((Date.now()-this.show_time)/1e3);e&&e.isEnded||void 0===e?(te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Complete,t),this.resolve&&this.resolve({code:0,data:{time:t}})):(te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Interrupt,t),this.reject&&this.reject(Object.assign(Object.assign({},e),{data:{time:t}}))),this.videoAd.offClose(this.handleClose),this.preloadVideo(this.adUnitId),this._isPlaying=!1,this._isErrored=!1;},this.handleError=e=>{te.__LOG__&&console.warn("====>激励视频加载失败",e),te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Fail),this.reject&&(this.videoAd?this.reject(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoFail),{data:{time:0}})):this.reject(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoWatchMax),{data:{time:0}}))),this.videoAd&&this.videoAd.offClose&&this.videoAd.offClose(this.handleClose),this._isPlaying=!1,this._isErrored=!0;},this._canUsed=te.Platform.isSupport("createRewardedVideoAd");}preloadVideo(e=s.videoAd){if(0==this._canUsed)return super.preloadVideo(e);if(this.preloadVideoAd||this.isPreload)return;this.isPreload=!0;let t=te.Platform.createRewardedVideoAd({adUnitId:e});t.onError(this.onErrorPre),t.load().then(this.handleLoaded2).catch(()=>{this.isPreload=!1;}),this.videoAd2=t;}handleLoaded2(){this.preloadVideoAd=this.videoAd2,this.isPreload=!1,te.__LOG__&&console.warn("视频预加载成功");}offPreload(){this.preloadVideoAd.offError(this.onErrorPre);}show(e){const t=Object.create(null,{show:{get:()=>super.show}});return i(this,arguments,void 0,function*(e,r=s.videoAd){return 0==this._canUsed?t.show.call(this,e,r):new Promise((t,s)=>i(this,void 0,void 0,function*(){if(this._isPlaying)return s(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoPlaying),{data:{time:0}}));if(!r)return s(Object.assign(Object.assign({},te.EnumConst.ShareVideoError.VideoInvalid),{data:{time:0}}));let i,n;if(this.preloadVideoAd?(te.__LOG__&&console.log("使用预加载视频"),n=!0,i=this.preloadVideoAd,this.offPreload()):(te.__LOG__&&console.log("不使用预加载视频"),n=!1,i=te.Platform.createRewardedVideoAd({adUnitId:r})),!i)return s(Object.assign({},te.EnumConst.ShareVideoError.VideoNotOpen));if(te.Analytics.adStat(e,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Request),this._isPlaying=!0,this._isErrored=!1,this.videoKey=e,this.adUnitId=r,this.resolve=t,this.reject=s,this.videoAd=i,i.onClose(this.handleClose),i.onError(this.onError01),n)try{yield this.handleLoaded();}catch(e){te.__LOG__&&console.log("error",e),yield i.load(),this.handleLoaded();}else try{yield i.load(),yield this.handleLoaded();}catch(e){this.handleError({});}te.__LOG__&&console.warn("====>激励视频请求adUnitId",r);}));});}handleLoaded(){return i(this,void 0,void 0,function*(){try{te.__LOG__&&console.warn("handleLoaded2"),te.Analytics.adStat(this.videoKey,this.adUnitId,te.EnumConst.DOT_AD_TYPE.Video,te.EnumConst.DOT_AD_STATUS.Show),this.videoAd.isReady()?(this.show_time=Date.now(),yield this.videoAd.show()):this.videoAd.load().then(()=>{this.show_time=Date.now(),this.videoAd.show();}).catch(this.handleError),te.__LOG__&&console.log("handleLoaded_show");}catch(e){te.__LOG__&&console.log("handleLoaded_show__err"),this.handleError({});}});}}class B{constructor(){this.exposureArr={},this.queue=[],this.exposureArr={};}setLogind(){if(this.queue.length>0)for(let e=0;e<this.queue.length;e++){(0,this.queue[e])();}this.queue=[],this.active();}dot(e){return i(this,arguments,void 0,function*(e,t={}){let i="",s="";if("{}"!=JSON.stringify(t)&&"object"==typeof t)for(let e in t)""===i&&(i=e,s=t[e]);else if("string"==typeof t){var r=t;t={from:r},i="from",s=r;}this.checkLogin(()=>g.dot(Object.assign(Object.assign({},this._buildParams()),{eventkey:e,value:JSON.stringify(t),itemkey:i,itemvalue:s})));});}levelStart(e,t,s){return i(this,void 0,void 0,function*(){t||(t=`第${e}关`),s||(s="普通模式");this.checkLogin(()=>g.level(Object.assign(Object.assign({},this._buildParams()),{stageid:e,stagename:t,pattern:s,typ:1})));});}levelRunning(e,t,s,r,n,a,o,d){return i(this,void 0,void 0,function*(){t||(t=`第${e}关`),s||(s="普通模式");this.checkLogin(()=>g.level(Object.assign(Object.assign({},this._buildParams()),{stageid:e,stagename:t,pattern:s,event:r,params_id:n,params_name:a,params_count:o,params_desc:d,typ:2})));});}levelEnd(e,t,s,r,n,a){return i(this,arguments,void 0,function*(e,t,i,s,r,n,a=0){t||(t=`第${e}关`),i||(i="普通模式");this.checkLogin(()=>g.level(Object.assign(Object.assign({},this._buildParams()),{stageid:e,stagename:t,pattern:i,event:s,times:r,perc:n,typ:3,valence:a})));});}loadingFinish(){return i(this,void 0,void 0,function*(){this.checkLogin(()=>g.loadingFinish(Object.assign({},this._buildParams()))),this.checkStartStay();});}active(){return i(this,void 0,void 0,function*(){this.checkLogin(()=>g.active(Object.assign(Object.assign({},this._buildParams()),{isnew:0,sharekey:te.DataService.shareKey,shareid:te.DataService.shareId})));});}logOut(e){this.checkLogin(()=>g.logOut(Object.assign(Object.assign({},this._buildParams()),{times:e})));}share(e,t,i){this.checkLogin(()=>g.share(Object.assign(Object.assign({},this._buildParams()),{typ:i,sharekey:e,shareid:t,shareuid:i===te.EnumConst.DOT_SHARE_TYPE.Click?te.DataService.queryUserInviteUid:""})));}adStat(e,t,i,s,r){this.checkLogin(()=>g.adStat(Object.assign(Object.assign({},this._buildParams()),{videokey:e,adplat:"1",adid:t,adtyp:i,adstatus:s,times:r})));}checkStartStay(){if(0==c.isSameDayForDate(te.DataService.regDate,te.Time.currentDate))return;1!=+te.LocalStorage.getItem("newUserDot")&&te.EventCenter.on(te.EventCenter.SECOND_CHANGE,this._stayFun,this);}_stayFun(){let e=+te.LocalStorage.getItem("newUserTime");e+=1,te.LocalStorage.setItem("newUserTime",e+""),e>=30&&(te.LocalStorage.setItem("newUserDot","1"),this._loadingFinishStay(30),te.EventCenter.off(te.EventCenter.SECOND_CHANGE,this._stayFun,this));}_loadingFinishStay(e){return i(this,void 0,void 0,function*(){this.checkLogin(()=>{g.stay(Object.assign(Object.assign({},this._buildParams()),{times:e}));});});}behaviors(){this.checkLogin(()=>g.behaviors(Object.assign({},this._buildParams())));}checkLogin(e){te.Login.isLogin?e():this.queue.push(e);}jumps(e,t){this.checkLogin(()=>g.jumps(Object.assign(Object.assign({},this._buildParams()),{adid:0,adplat:1,adtyp:t,typ:1,times:1,id:e})));}bannerExposure2(e,t,i){this.checkLogin(()=>g.jumps(Object.assign(Object.assign({},this._buildParams()),{adid:0,adplat:1,adtyp:t,typ:2,times:i,id:e})));}addExposure(e,t){t&&t.forEach(t=>{let{id:i}=t;if(this.exposureArr.hasOwnProperty(e)){this.exposureArr[e].hasOwnProperty(i)?this.exposureArr[e][i]++:this.exposureArr[e]=Object.assign(Object.assign({},this.exposureArr[e]),{[i]:1});}else{let t={[e]:{[i]:1}};this.exposureArr=Object.assign(Object.assign({},this.exposureArr),t);}});}bannerExposure(){if("{}"===JSON.stringify(this.exposureArr))return;let e=JSON.parse(JSON.stringify(this.exposureArr));this.exposureArr={};for(let t in e){let i=e[t];for(let e in i)this.bannerExposure2(e,t,i[e]);}}role(e,t){this.checkLogin(()=>g.role(Object.assign(Object.assign({},this._buildParams()),{role_name:e,region:t})));}clientLog(e,t=j.debug){switch(g.client_log({APIVersion:"0.6.0",gameid:s.game_id,cacheUserId:te.DataService.uid,level:j[t],content:e}),t){case j.error:console.error(e);break;case j.debug:console.log(e);break;case j.info:console.info(e);break;case j.warning:console.warn(e);break;default:console.log(e);}}consume(e,t,i,s){this.checkLogin(()=>g.consume(Object.assign(Object.assign({},this._buildParams()),{id:e,typ:t,nums:i,gsne:s})));}daystay(){this.checkLogin(()=>g.daystay(Object.assign({},this._buildParams())));}_buildParams(){let e=te.SDKVersion,t=te.DataService.channelId,i=te.Platform.getSystemInfoSync();return{channel:t,APIVersion:"0.6.0",brand:i.brand,model:i.model,version:i.version,system:i.system,platform:i.platform,sdkversion:i.SDKVersion,scene:te.DataService.scene+"",uid:te.DataService.uid,env:1===te.DataService.envEnum?"pre":"prod",logindays:te.DataService.logindays,amount:te.DataService.amount,pon:te.DataService.pon,pkv:e,ptm:te.DataService.ptm,account_id:te.DataService.ad_info.account_id,adgroup_id:te.DataService.ad_info.adgroup_id,creative_id:te.DataService.ad_info.creative_id,strategy:te.DataService.ad_info.strategy};}}!function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warning=2]="warning",e[e.error=3]="error",e[e.critical=4]="critical";}(j||(j={}));const W="puchi_sdk_today_online_time";class Y{constructor(){this.token="",this.refToken="",this.expire=0,this.isnew=0,this.scene="0",this.openid="",this.uid="",this.regDate=new Date(),this.launchTime=0,this.shareId="0",this.shareKey="",this.networkType=l.NetworkType.Unknown,this.gender=l.Gender.Unknown,this.channelId="",this.queryChannelId="",this.inviteType=0,this.shareTicket="",this.systemId=0,this.launchKey="",this.launchSource=-1,this.authorize=!1,this.referrerInfo={},this.version="",this.cdnUrl="",this.envEnum=l.VersionEnv.STAGE,this.queryUserInviteUid=0,this.queryExtData={},this.shield=0,this.configParams=null,this.userState=l.UserState.Default,this.isCross=!1,this.isDrawer=!1,this.isGuessLike=!1,this.logindays=0,this.amount=0,this.pon=0,this.ptm=0,this.clue_token="",this.creative_id="",this.advertister_id="",this.request_id="",this.userinfo={},this.sdkVersion="",this.city="",this.isKeyCity=!1,this.ad_info={};}}class K{constructor(){this._countimeTime=null,this._leftDot=!1,this._data=new Y();}init(){this._localStorgeGet(),this._onlineTime=te.Time.currentTime,te.Platform.onShow(this._onShow.bind(this)),te.Platform.onHide(this._onHide.bind(this)),te.Platform.onNetworkStatusChange(this._onNetworkStatusChange.bind(this)),te.EventCenter.on(te.EventCenter.DAY_CHANGE,this._onDayChange,this),te.EventCenter.on(te.EventCenter.SECOND_CHANGE,this._onSecondChange,this);}_onDayChange(){this.updateData({ptm:0,logindays:this.logindays+1,isnew:0}),this._leftDot=!1,this._countimeTime=0;}_onSecondChange(){this._countimeTime+=1,0==this._leftDot&&this._countimeTime>=300&&(this._leftDot=!0,this.updateData({ptm:1}),te.Analytics.daystay()),this._localStorageSet();}_localStorageSet(){te.LocalStorage.setItem(W,JSON.stringify({countimeTime:this._countimeTime,isDotToday:this._leftDot?1:0,saveTime:te.Time.currentTime}));}_localStorgeGet(){let e,t=te.LocalStorage.getItem(W);try{e=JSON.parse(t),e.saveTime&&!c.isSameDayForTime(e.saveTime,te.Time.currentTime)?(this._countimeTime=0,this._leftDot=!1):(this._countimeTime=e.countimeTime?e.countimeTime:0,this._leftDot=!!e.isDotToday);}catch(e){this._countimeTime=0,this._leftDot=!1;}}updateData(e){if(null==e)return;let t=Object.keys(e);for(let i of t){null!=e[i]&&(null==this._data[i]?console.log("为undefined的key",i):this._data[i]=e[i]);}}initWithLaunch(){var e;let t=te.Platform.getSystemInfoSync(),i=te.Platform.getLaunchOptionsSync(),{query:r,scene:n,referrerInfo:a}=i,{invite_type:o,channelId:d,channel_id:h,td_channelid:l,channel:c,share_id:u,share_key:m,user_invite_uid:g,weixinadinfo:_,account_id:p,service_id:y,shareMessageToFriendScene:S,clue_token:f,ad_id:v,creative_id:A,advertister_id:D,request_id:w}=r,b=d||h||c||l;if(_){//!fromChannel && 
let e=_.split(".");e&&e.length&&(b=e[0]);}if(v&&(b=v),+S>=0&&+S<=50&&(m=s.shareMessageToFriend.sharekey,u=s.shareMessageToFriend.share_id+""),te.IsTb){n=void 0;let t=my.tb.getInteractiveSDK().getChannelTag(),i=null===(e=null==t?void 0:t.extra)||void 0===e?void 0:e.raw;i&&(b=i);}if(te.__LOG__){let e={user_invite_uid:g,fromChannel:b,channelId:d,scene:n,share_id:u,share_key:m};console.warn("====> 初始化参数",e);}this.updateData({scene:n+"",referrerInfo:a||{},shareId:u,systemId:"android"===t.platform?1:0,shareKey:m,channelId:b,queryChannelId:b||s.channel_id,inviteType:o,queryUserInviteUid:+g,clue_token:f,creative_id:A,advertister_id:D,request_id:w,queryExtData:{account_id:p,service_id:y}}),te.Platform.getNetworkType().then(e=>this._onNetworkStatusChange(e));}_onShow(e){console.log("onshow_opts",e);let{scene:t,shareTicket:i}=e;this._onlineTime=te.Time.currentTime;let s={};if(s.scene=t,s.launchTime=this._onlineTime,e&&e.query){let{share_key:t,share_id:r,invite_type:n,user_invite_uid:a}=e.query;s.shareId=r,s.shareKey=t,s.inviteType=n,s.shareTicket=i,s.queryUserInviteUid=a,r&&t&&te.Analytics.share(t,r,te.EnumConst.DOT_SHARE_TYPE.Click);}this.updateData(s),te.EventCenter.emit(te.EventCenter.APP_SHOW,e);}_onHide(){te.Analytics.bannerExposure(),this._onlineTime&&(te.Analytics.logOut(1e3*(te.Time.currentTime-this._onlineTime)),this._onlineTime=0),te.EventCenter.emit(te.EventCenter.APP_HIDE);}_onNetworkStatusChange(e){this._data.networkType!=e.networkType&&(console.warn("网络变化了：",e),this._data.networkType=e.networkType);}get expire(){return this._data.expire;}get isnew(){return this._data.isnew;}get logindays(){return this._data.logindays;}get amount(){return this._data.amount;}get pon(){return this._data.pon;}get ptm(){return this._data.ptm;}get scene(){return this._data.scene;}get referrerInfo(){return this._data.referrerInfo;}get token(){return this._data.token;}get refToken(){return this._data.refToken;}get openid(){return this._data.openid;}get regDate(){return this._data.regDate;}get launchTime(){return this._data.launchTime;}get shareId(){return this._data.shareId;}get shareKey(){return this._data.shareKey;}get gender(){return this._data.gender;}get channelId(){return this._data.channelId;}get queryChannelId(){return this._data.queryChannelId;}get inviteType(){return this._data.inviteType;}get queryUserInviteUid(){return this._data.queryUserInviteUid;}get queryExtData(){return this._data.queryExtData;}get shield(){return this._data.shield;}get shareTicket(){return this._data.shareTicket;}get systemId(){return this._data.systemId;}get uid(){return this._data.uid;}get authorize(){return this._data.authorize;}get version(){return this._data.version;}get cdnUrl(){return this._data.cdnUrl;}get launchKey(){return this._data.launchKey;}get isCross(){return this._data.isCross;}get isDrawer(){return this._data.isDrawer;}get isGuessLike(){return this._data.isGuessLike;}get envEnum(){return this._data.envEnum;}get clue_token(){return this._data.clue_token;}get creative_id(){return this._data.creative_id;}get advertister_id(){return this._data.advertister_id;}get request_id(){return this._data.request_id;}get userinfo(){return this._data.userinfo?this._data.userinfo:{nickname:"",headurl:""};}get ad_info(){return this._data.ad_info;}get LoginApi(){let e=r.Login.Prod;return this.envEnum==te.EnumConst.VersionEnv.PRE&&(e=r.Login.Pre),e;}get GameApi(){let e=r.Game.Prod;return this.envEnum==te.EnumConst.VersionEnv.PRE&&(e=r.Game.Pre),e;}get DotApi(){let e=r.Dot.Prod;return this.envEnum==te.EnumConst.VersionEnv.PRE&&(e=r.Dot.Pre),e;}get OrderApi(){let e=r.Order.Prod;return this.envEnum==te.EnumConst.VersionEnv.PRE&&(e=r.Order.Pre),e;}get GMApi(){let e=r.GM.Prod;return this.envEnum==te.EnumConst.VersionEnv.PRE&&(e=r.GM.Pre),e;}get isKeyCity(){return this._data.isKeyCity;}get city(){return this._data.city;}setCity(e){if(e){this._data.city=e;let t=["北京","上海","广州","深圳","杭州"];for(let i of t)e.includes(i)&&(this._data.isKeyCity=!0);}console.log(`城市${e}, ${this.isKeyCity}`);}}class Q{getEnv(){return i(this,void 0,void 0,function*(){if(te.IsWeb)return te.__LOG__&&console.log("当前是web环境 直接走测试服"),void te.DataService.updateData({envEnum:te.EnumConst.VersionEnv.PRE});let e=yield g.Version();if(0==e.code){let t=e.data.env;te.__LOG__&&console.log("版本信息",1==t?"测试服":"正式服"),te.DataService.updateData({envEnum:Number(t)});}else te.DataService.updateData({envEnum:te.EnumConst.VersionEnv.STAGE});return e;});}saveData(e,t,i,s){let r={key:e,content:JSON.stringify(t),uid:te.DataService.uid,token:te.DataService.token,aup:s};return i&&(r.extend=JSON.stringify(i)),g.saveData(r);}getData(e){return i(this,void 0,void 0,function*(){return g.getData({key:e,uid:te.DataService.uid,token:te.DataService.token});});}headSet(e){return g.headSet(Object.assign(Object.assign({},e),{uid:te.DataService.uid,token:te.DataService.token}));}rankAdd(e,t,i=l.RankType.Forever,s=1){return g.rankAdd({typ:e,sort:s,t:i,fraction:t,uid:te.DataService.uid,token:te.DataService.token});}rankList(e,t=l.RankType.Forever,i=!1,s=1){return g.rankList({t:t,typ:e,sort:s,rankdata:i?1:0,uid:te.DataService.uid,token:te.DataService.token});}rankListV2(e){return g.rankListV2({gameid:te.GAMEDATA.game_id,uid:te.DataService.uid,token:te.DataService.token,key:e});}rankAddV2(e){let t={key:e.key,gameid:te.GAMEDATA.game_id,uid:te.DataService.uid,token:te.DataService.token};return e.extend&&(t.extend=JSON.stringify(e.extend)),e.fraction&&(t.fraction=e.fraction),e.score&&(t.score=e.score),g.rankAddV2(t);}getAdList(e){return g.adList({adtyp:e,uid:te.DataService.uid,token:te.DataService.token});}getNotice(){return g.notice({uid:te.DataService.uid,token:te.DataService.token,gameid:te.GAMEDATA.game_id});}getEmail(){return g.email({uid:te.DataService.uid,token:te.DataService.token,gameid:te.GAMEDATA.game_id});}setMailStatus(e,t){return g.emailStatus({ids:e.join(","),status:t.join(","),uid:te.DataService.uid,token:te.DataService.token,gameid:te.GAMEDATA.game_id});}sendSubScribe(e,t,i,s=1){let r={uid:+te.DataService.uid,token:te.DataService.token+"",openid:te.DataService.openid+"",status:s,message:encodeURIComponent(t),temid:e};return 1==s?r.sendTime=Math.floor(i):r.times=Math.floor(i),g.sendsubscribe(r);}cancelSubscribe(e){let t={uid:+te.DataService.uid,token:te.DataService.token+"",openid:te.DataService.openid+"",temid:e};return g.cancelSubscribe(t);}behavior(){let e=te.DataService.uid,t=te.DataService.token,i=te.DataService.openid;return g.behavior({openid:i,uid:e,token:t});}dy2wxReport(){var e;let t=te.DataService.uid,i=te.DataService.token,s=te.DataService.openid,r=null===(e=te.Platform.getSystemInfoSync())||void 0===e?void 0:e.platform,n=te.DataService.channelId;return g.dy2wxReport({openid:s,uid:t,token:i,platform:r,channel:n});}wxEstimate(e,t){var i;let s=te.DataService.uid,r=te.DataService.token,n=te.DataService.openid,a=te.DataService.channelId,o=null===(i=te.Platform.getSystemInfoSync())||void 0===i?void 0:i.platform;return g.wxEstimate({iv:e,encryptedData:t,openid:n,uid:s,token:r,platform:o,channel:a});}static navigateToMiniProgram(e){te.Analytics.jumps(e.id,e.adtyp);let t=e.path;return null==t?t=`?channel_id=${s.channel_id}`:0==t.includes("channel_id")&&(t+=`&channel_id=${s.channel_id}`),new Promise(s=>i(this,void 0,void 0,function*(){let i=yield te.Platform.navigateToMiniProgram({appId:e.appid,path:t});s(i);}));}isAddHomePageInMy(){return i(this,void 0,void 0,function*(){if(0==te.IsMy)return Promise.resolve({code:-1,msg:"非支付宝平台"});let e={uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid},t=yield g.isAddHomePage(e);return t.code?t:"Y"==t.data.consult_result?{code:0,msg:"已添加首页"}:{code:1,msg:"未添加首页"};});}qureyChannelInTb(){if(0==te.IsTb)return Promise.resolve({code:-1,msg:"非淘宝平台"});let e=my.tb.getInteractiveSDK().getChannelTag();return"ceiling"===e.tag&&"mini_ceiling"===e.extra.raw?Promise.resolve({code:0,data:"channel"}):"WIDGET"==e.type?Promise.resolve({code:0,data:"widget"}):Promise.resolve({code:-1,msg:e});}checkGameCenterMiniWidgetInTb(){return 0==te.IsTb?Promise.resolve({code:-1,msg:"非淘宝平台"}):new Promise(e=>i(this,void 0,void 0,function*(){(yield my.tb.createWidgetInstance({id:219,typeId:"gameCenterMini"})).getInstallInfo({guideFrom:te.GAMEDATA.tb_game_id}).then(t=>{var i;let s=null===(i=null==t?void 0:t.widgetInfo)||void 0===i?void 0:i.isInstalled;e(s?{code:0,data:!0,msg:"成功"}:{code:-1,msg:JSON.stringify(t)});}).catch(t=>{e({code:-1,msg:JSON.stringify(t)});});}));}addGameCenterMiniWidgetInTb(){return i(this,void 0,void 0,function*(){return 0==te.IsTb?Promise.resolve({code:-1,msg:"非淘宝平台"}):0==te.Platform.isSupport("tb.createWidgetInstance")?Promise.resolve({code:-1,msg:"淘宝平台  my.tb.createWidgetInstance不存在"}):new Promise(e=>i(this,void 0,void 0,function*(){const t=yield my.tb.createWidgetInstance({id:219,typeId:"gameCenterMini"});t.getInstallInfo({guideFrom:te.GAMEDATA.tb_game_id}).then(i=>{(null==i?void 0:i.available)&&t.install({guideFrom:te.GAMEDATA.tb_game_id,installSuccessCallback:t=>{e({code:0,data:t,msg:"成功"});}});}).catch(t=>{e({code:-1,msg:JSON.stringify(t)});});}));});}incrementGameactionInMy(e){return i(this,void 0,void 0,function*(){if(0==te.IsMy)return Promise.resolve({code:-1,msg:"非支付宝平台"});if(""==te.DataService.uid)return Promise.resolve({code:-1,msg:"未登录"});te.Analytics.dot("alipay",{key:"finish_"+e});let t="other",i=te.Platform.getLaunchOptionsSync();t=null==i.query.channel||i.query.channel.length<=0||null==i.query.channel?"other":i.query.channel;let s={uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid,action_code:e,action_finish_channel:t};return(yield g.aliMission(s)).code?(te.Analytics.dot("alipay",{key:"fail_"+e}),!1):(te.Analytics.dot("alipay",{key:"complete_"+e}),!0);});}intergralAuthInMy(e,t){return g.alipayIntergralAuth({uid:te.DataService.uid,token:te.DataService.token,code:e,point:t?1:0});}intergralQueryInMy(){return g.alipayIntergralQuery({uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid});}intergralBuyInMy(e,t,i){return g.alipayIntergralBuy({uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid,biz_type:e,biz_sub_type:t,point:i});}setSwipeBackEnabledInTb(e){return 0==te.IsTb?Promise.resolve({code:-1,msg:"非淘宝平台"}):te.Platform.isSupport("tb.enableSwipeBack")?(my.tb.enableSwipeBack({enable:e?1:0}),Promise.resolve({code:0,msg:"成功"})):Promise.resolve({code:-1,msg:"平台不支持"});}switchBackButtonInTb(e){return i(this,void 0,void 0,function*(){if(0==te.IsTb)return Promise.resolve({code:-1,msg:"非淘宝平台"});(yield this.checkTinyAppPermission(e?"showBackButton":"hideBackButton")).code||(e?my.showBackButton(function(e){console.log("显示退出按钮");}):my.hideBackButton(function(e){console.log("隐藏退出按钮");}));});}checkTinyAppPermission(e){return new Promise(t=>{my.checkTinyAppPermission({apiName:e,success:e=>{t({code:0,msg:"成功"});},fail:e=>{t({code:-1,msg:"未开放权限"});}});});}tbAwardAd(){return g.tbAwardAd({uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid});}receiveTbAward(e){return g.receiveTbAward({ids:e,uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid});}douyinFeedAdd(e,t,i){return g.douyinFeedAdd({content_id:e,feed_scene:t,feed_time:i,uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid});}douyinFeedCard(){return g.douyinFeedCard({uid:te.DataService.uid,token:te.DataService.token,openid:te.DataService.openid});}wxDecryption(e,t){let i={uid:+te.DataService.uid,token:te.DataService.token+"",openid:te.DataService.openid+"",iv:e,encryptedData:t};return g.wxDecryption(i);}isWhite(){if(te.IsWeb)return!0;let e=te.OnlineService.getParamsString("GMWhiteId");if(""==e||null==e)return!1;let t=e.split(",");return!(!t.includes(te.DataService.openid)&&!t.includes(te.DataService.uid.toString()));}}var J;!function(e){let t;e.setData=function(e){e&&(t=e);},e.updateOnlineConfig=function(){return new Promise(e=>{g.getConfig().then(i=>{0==i.code&&(t=i.data.config),e(i);});});},e.getParamsObj=function(e,i={}){if(!t)return i;let s=t[e];return null==s?i:JSON.parse(s);},e.getParamsInt=function(e,i=0){if(!t)return i;let s=t[e];return null==s?i:parseInt(s);},e.getParamsString=function(e,i=""){if(!t)return i;let s=t[e];return null==s?i:s;};}(J||(J={}));class z{constructor(){this.DAY_CHANGE="sdk_event_change_day",this.SECOND_CHANGE="sdk_event_change_second",this.APP_SHOW="sdk_event_app_show",this.APP_HIDE="sdk_event_app_hide",this.USER_INFO_UPDATE="sdk_event_user_info_update",this._events={};}_getListeners(e){let t=this._events;return t[e]||(t[e]=[]);}_getListenersAsObject(e){let t,i=this._getListeners(e);return i instanceof Array&&(t={},t[e]=i),t||i;}_isValidListener(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&this._isValidListener(e.listener);}_getOnceReturnValue(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue;}set onceReturnValue(e){this._onceReturnValue=e;}indexOf(e,t,i){let s=e.length;for(;s--;)if(e[s].listener===t&&(!i||e[s].context===i))return s;return-1;}on(e,t,i){if(!e||!e.constructor)throw new TypeError("evt must be a string");if(!this._isValidListener(t))throw new TypeError("listener must be a function");let s,r=this._getListenersAsObject(e),n="object"==typeof t;for(s in r)r.hasOwnProperty(s)&&-1===this.indexOf(r[s],t,i)&&r[s].push(n?t:{listener:t,context:i,once:!1});return this;}once(e,t,i){return this.on(e,{listener:t,context:i,once:!0});}off(e,t,i){let s,r,n=this._getListenersAsObject(e);for(r in n)n.hasOwnProperty(r)&&(s=this.indexOf(n[r],t,i),-1!==s&&n[r].splice(s,1));return this;}offAll(e){let t=typeof e,i=this._events;return"string"===t?delete i[e]:delete this._events,this;}emit(e,...t){let i,s,r,n,a,o=this._getListenersAsObject(e);for(n in o)if(o.hasOwnProperty(n))for(i=o[n].slice(0),r=0;r<i.length;r++)s=i[r],!0===s.once&&this.off(e,s.listener,s.context),a=s.listener.apply(s.context||this,t||[]),a===this._getOnceReturnValue()&&this.off(e,s.listener,s.context);return this;}defineEvent(e){return this._getListeners(e),this;}defineEvents(e){for(let t=0,i=e.length;t<i;t++)this.defineEvent(e[t]);return this;}}class ${constructor(){this.isDebug=!1,this.onShowAd=!1,this._forwardKey="forward",this._shareObjs={default:[s.default_share]},this.cnt=1;}get shareObjs(){return this._shareObjs;}setForwardKey(e){this._forwardKey=e,this.forward(this._forwardKey);}initList(){return i(this,void 0,void 0,function*(){let e=yield g.ShareList();if(e.code)return setTimeout(this.initList.bind(this),200*this.cnt),void this.cnt++;this._setShareVideoData(e),this._forwardKey&&this.forward(this._forwardKey),te.RewardVideo.preloadVideo();});}init(){return i(this,void 0,void 0,function*(){this.initList(),te.Platform.updateShareMenu({withShareTicket:!0}),s.shareMessageToFriend.scene>0&&te.Platform.setMessageToFriendQuery(s.shareMessageToFriend.scene);});}play(e,t={}){return this.isDebug?Promise.resolve({code:0,msg:"模拟播放成功"}):new Promise(i=>{let{id:s,typ:r,content:n,key:a,icon:o,videoid:d}=this.getShareVideoData(e);t.share_type&&(r=t.share_type),r=Number(r),this.onShowAd=!0;let h=()=>{let e={title:n,imageUrl:o,query:this._createQuery({share_key:a,share_id:s,query:t.query})};return t.title&&(e.title=t.title),t.img_url&&(e.imageUrl=t.img_url),e;},l=e=>{e.data=e.data||{},e.data.share_type=r;};switch(""!=d&&null!=d||(d=void 0),r){case te.EnumConst.ShareVideoType.Video:te.RewardVideo.show(e,d).then(e=>{this.onShowAd=!1,l(e),i(e);}).catch(e=>{this.onShowAd=!1,l(e),i(e);});break;case te.EnumConst.ShareVideoType.VideoToShare:te.RewardVideo.show(e,d).then(e=>{this.onShowAd=!1,l(e),i(e);}).catch(t=>{if(t.code&&1e3!==t.code&&1003!==t.code){let t=te.Time.currentTime;te.Platform.shareAppMessage(h()).then(r=>{this.onShowAd=!1,0==r.code&&te.Analytics.share(e,s,te.EnumConst.DOT_SHARE_TYPE.Share);let n=te.Time.currentTime;l(r),r.data.time=n-t,i(r);});}else this.onShowAd=!1,l(t),i(t);});break;case te.EnumConst.ShareVideoType.Share:let t=te.Time.currentTime;te.Platform.shareAppMessage(h()).then(r=>{this.onShowAd=!1,0==r.code&&te.Analytics.share(e,s,te.EnumConst.DOT_SHARE_TYPE.Share);let n=te.Time.currentTime;l(r),r.data.time=n-t,i(r);});break;default:this.onShowAd=!1,i({code:-1,msg:"无分享视频",data:{share_type:te.EnumConst.ShareVideoType.None,time:0}});}});}forward(e){let t=this.getShareVideoData(e||this._forwardKey),i={title:t.content,imageUrl:t.icon,query:this._createQuery({share_key:t.key,share_id:t.id})};te.EnumConst.ShareVideoType.None,te.Platform.onShareAppMessage(i);}getShareVideoType(e){let t=this.getShareVideoData(e);return t?t.typ:te.EnumConst.ShareVideoType.None;}_setShareVideoData(e){(e.data||[]).forEach(e=>{this._shareObjs[e.key]=this._shareObjs[e.key]||[],this._shareObjs[e.key].push(e);});}getShareVideoData(e){let t=this._shareObjs[e];return t||(t=this._shareObjs.default),t[c.randomInt(0,t.length)];}_createQuery(e={}){let t=e.query;if(delete e.query,t)for(let i in t)e[i]=t[i];e=Object.assign(Object.assign({},e),{channel_id:s.channel_id,user_invite_uid:te.DataService.uid,user_invite_openid:te.DataService.openid});let i="";for(let t in e)i.length&&(i+="&"),i+=`${t}=${e[t]}`;return i;}}class X{constructor(){this._isPuase=!1,this._currentDate=new Date(),this._newDayCutDown=0,this._refreshTime=()=>i(this,void 0,void 0,function*(){var e;if(this.isLocalTime)this._updateCurrentTime(Math.floor(new Date().getTime()/1e3));else{let t=null===(e=yield g.getServerTime())||void 0===e?void 0:e.data;t?this._updateCurrentTime(t.servertime):this._updateCurrentTime(Math.floor(new Date().getTime()/1e3));}}),this._clearTime=()=>{this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null);},this._addTime=()=>{this.isPuase||(this._currentTime+=1,this._currentDate.setTime(1e3*this._currentTime),this._newDayCutDown-=1,this._newDayCutDown<0&&(te.EventCenter.emit(te.EventCenter.DAY_CHANGE,this.currentTime),this._newDayCutDown=Z(this.currentDate)/1e3-this.currentTime),te.EventCenter.emit(te.EventCenter.SECOND_CHANGE,1,this.currentTime));};}get isPuase(){return this._isPuase;}setPause(e){this._isPuase=e;}get currentTime(){return this._currentTime;}get currentDate(){return new Date(this._currentDate);}init(){return i(this,void 0,void 0,function*(){yield this._refreshTime(),te.Platform.onHide(()=>this._clearTime()),te.Platform.onShow(()=>this._refreshTime());});}_updateCurrentTime(e){this._clearTime(),this._currentTime=e,this._currentDate.setTime(1e3*this._currentTime),this._newDayCutDown=Z(this.currentDate)/1e3-this.currentTime,this._intervalId=setInterval(this._addTime,1e3),console.log("同步时间:",this._currentDate.toLocaleString());}switchLocalTime(e){e!=this.isLocalTime&&(e?(console.log("切换到本地时间"),te.LocalStorage.setItem("isLocalTime","1")):(console.log("切换到服务器时间"),te.LocalStorage.setItem("isLocalTime","0")),this._refreshTime());}get isLocalTime(){return"1"==te.LocalStorage.getItem("isLocalTime");}}function Z(e,t=0){var i=e.getTime()+864e5;return e.setTime(i),e.setHours(t,0,0),e.getTime();}let ee=new class{constructor(){this.SDKVersion="2.0.1",this.EnumConst=l,this.OnlineService=J,this._initState=l.InitState.None,this.Utils=c,this._initResolveArr=[];}get initState(){return this._initState;}_initFrist(){this.IsWx=!1,this.IsTt=!1,this.IsMy=!1,this.IsTb=!1,this.IsWeb=!1,this.Time=new X(),this.EventCenter=new z(),this.Analytics=new B(),this.DataService=new K(),this.GameService=new Q(),this.ShareVideoService=new $(),this.GAMEDATA=s,this.HOST=r,this.HOSTAPIS=n;}_initWx(){this.IsWx=!0,this.Platform=new G(),this.Banner=new R(),this.RewardVideo=new N(),this.CustomAd=new H(),this.InterstitialAd=new F(),this.Pay=new q();}_initTt(){this.IsTt=!0,this.Platform=new V(),this.RewardVideo=new x(),this.Pay=new U(),this.InterstitialAd=new L();}_initMy(){this.IsMy=!0,this.Platform=new I(),this.Banner=new D(),this.RewardVideo=new T(),this.InterstitialAd=new w(),this.Pay=new b();}_initTb(){this.IsTb=!0,this.Platform=new O(),this.RewardVideo=new k(),this.Http=new P(),this.Login=new E(),this.Pay=new C();}_tryInitDefaultMoudle(){this.Platform||(this.Platform=new v()),this.Banner||(this.Banner=new a()),this.RewardVideo||(this.RewardVideo=new A()),this.CustomAd||(this.CustomAd=new o()),this.InterstitialAd||(this.InterstitialAd=new m()),this.Pay||(this.Pay=new p()),this.Http||(this.Http=new u()),this.LocalStorage||(this.LocalStorage=localStorage),this.Login||(this.Login=new _()),this.Banner.init(),this.Login.init();}awaitInit(){return this._initState==l.InitState.End?Promise.resolve(!0):new Promise(e=>this._initResolveArr.push(()=>e(!0)));}init(e){return i(this,void 0,void 0,function*(){if(this._initState!=l.InitState.None)return console.log("重复初始化PUCHI_SDK"),this.awaitInit();if(this._initState=l.InitState.Ing,this._init(e.env),e.gameData&&c.deepReplace(e.gameData,s),e.host&&c.deepReplace(e.host,r),e.hostApis){for(let t in e.hostApis){let i=e.hostApis[t];i.includes("{{gameid}}")&&(i=i.replace("{{gameid}}",s.game_id),e.hostApis[t]=i);}c.deepReplace(e.hostApis,n);}e.platform&&this.Platform.init(e.platform),this.Http._init(),yield this.GameService.getEnv(),yield this.Time.init(),this.ShareVideoService.init(),this.DataService.init(),this.DataService.initWithLaunch();for(let e of this._initResolveArr)e();this._initResolveArr.length=0,this._initState=l.InitState.End;});}_init(e){this.EnvName=e,e==l.Env.微信?this._initWx():e==l.Env.支付宝?this._initMy():e==l.Env.淘宝?this._initTb():e==l.Env.抖音?this._initTt():(this.IsWeb=!0,this.ShareVideoService.isDebug=!0),this._tryInitDefaultMoudle();}get inited(){return this._initState==l.InitState.End;}}();ee._initFrist();const te=ee;window.PUCHI_SDK=ee,e.PUCHI_SDK=te,Object.defineProperty(e,"__esModule",{value:!0});}({});}).call(root);})(// The environment-specific global.
function(){if(typeof globalThis!=='undefined')return globalThis;if(typeof self!=='undefined')return self;if(typeof window!=='undefined')return window;if(typeof global!=='undefined')return global;if(typeof this!=='undefined')return this;return{};}.call(this));