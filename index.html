<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <title>Cocos Creator | block_2025</title>

    <!--http://www.html5rocks.com/en/mobile/mobifying/-->
    <meta name="viewport"
        content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1,minimal-ui=true" />

    <!--https://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

    <!-- force webkit on 360 -->
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <!-- force edge on IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="msapplication-tap-highlight" content="no">

    <!-- force full screen on some browser -->
    <meta name="full-screen" content="yes" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="360-fullscreen" content="true" />

    <!--fix fireball/issues/3568 -->
    <!--<meta name="browsermode" content="application">-->
    <meta name="x5-page-mode" content="app">

    <!--<link rel="apple-touch-icon" href=".png" />-->
    <!--<link rel="apple-touch-icon-precomposed" href=".png" />-->

    <link rel="stylesheet" type="text/css" href="style.css" />



    <!-- [CUSTOM] Dynamic Telegram Platform Loader -->
    <script>
        (function () {
            function loadScript(src, onload) {
                var s = document.createElement('script');
                s.src = src;
                s.onload = onload;
                document.head.appendChild(s);
            }

            var urlParams = new URLSearchParams(window.location.search);
            // Check for Telegram environment:
            // 1. 'tgWebAppData' present in URL queries (standard for Mini Apps)
            // 2. 'platform=telegram' query param (manual debugging)
            // 3. 'TelegramWebviewProxy' in window (some TG clients)
            var isTelegram = urlParams.has('tgWebAppData') ||
                urlParams.get('platform') === 'telegram' ||
                typeof window.TelegramWebviewProxy !== 'undefined';

            if (isTelegram) {
                console.log('[Loader] Telegram detected. Loading SDKs...');

                // [MOCK] Inject Mock Data for Browser Simulation
                if (urlParams.get('platform') === 'telegram' && typeof window.Telegram === 'undefined') {
                    console.log('[Loader] Injecting Mock Telegram User Data...');
                    window.Telegram = {
                        WebApp: {
                            initDataUnsafe: {
                                user: {
                                    id: 123456789,
                                    first_name: "Test",
                                    last_name: "User",
                                    username: "testuser",
                                    language_code: "en" // Change to 'zh' to test Chinese
                                }
                            },
                            ready: function () { },
                            expand: function () { },
                            setHeaderColor: function () { },
                            HapticFeedback: { impactOccurred: function () { }, notificationOccurred: function () { } },
                            version: "6.0",
                            platform: "weba"
                        }
                    };
                }

                // 1. Load Telegram Web App JS (User requested)
                loadScript('https://telegram.org/js/telegram-web-app.js', function () {
                    console.log('[Loader] Telegram Web App SDK loaded.');

                    // [MOCK] Re-Inject Mock Data for Browser Simulation (After SDK Load)
                    if (urlParams.get('platform') === 'telegram') {
                        console.log('[Loader] Re-Injecting Mock Telegram User Data over SDK defaults...');
                        // Ensure initDataUnsafe exists
                        if (window.Telegram && window.Telegram.WebApp) {
                            window.Telegram.WebApp.initDataUnsafe = window.Telegram.WebApp.initDataUnsafe || {};
                            window.Telegram.WebApp.initDataUnsafe.user = {
                                id: 123456789,
                                first_name: "Test",
                                last_name: "User",
                                username: "testuser",
                                language_code: "en"
                            };
                            // Also mock the initData string if needed by backend validation (optional for client-only)
                            window.Telegram.WebApp.initData = "query_id=...&user=...";
                        }
                    }

                    // 2. Load Telegram Analytics
                    loadScript('https://tganalytics.xyz/index.js', function () {
                        if (window.TelegramAnalytics) {
                            window.TelegramAnalytics.init({
                                token: 'eyJhcHBfbmFtZSI6ImJsb2NrX2NhbnZhcyIsImFwcF91cmwiOiJodHRwczovL3QubWUvYmxvY2tjYW52YXNib3QiLCJhcHBfZG9tYWluIjoiaHR0cHM6Ly9ibG9ja2NhbnZhcy5wYWdlcy5kZXYvIn0=!i/6mHJCX4nKfATHdd1XrbQAslMAvEXi6xg5gEqckiY8=',
                                appName: 'block_canvas'
                            });
                            console.log('[Loader] Telegram Analytics initialized.');
                        }
                    });
                });
            } else {
                console.log('[Loader] Not Telegram environment. Valid for Yandex/Other.');
            }
        })();
    </script>
</head>

<body>
    <div id="GameDiv" cc_exact_fit_screen="false">
        <div id="Cocos3dGameContainer">
            <canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="99"></canvas>
        </div>
    </div>


    <!-- Polyfills bundle. -->

    <script src="src/polyfills.bundle.js" charset="utf-8"> </script>


    <!-- SystemJS support. -->
    <script src="src/system.bundle.js" charset="utf-8"> </script>

    <!-- Import map -->
    <script src="src/import-map.json" type="systemjs-importmap" charset="utf-8"> </script>

    <script>
        System.import('./index.js').catch(function (err) { console.error(err); })
    </script>

</body>

</html>